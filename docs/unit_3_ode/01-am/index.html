<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="description" content="An online course on Modelling and Scientific Computing in Python for the SABS:R3 Centre for Doctoral Training https://www.sabsr3.ox.ac.uk/">
<meta name="author" content="Martin Robinson">

    <link rel="shortcut icon" href="/ScientificComputingInMatlab/logos/dtc_hex.svg" type="image/x-icon" />

    <title>ODE Solvers - AM exercise   Modelling and Scientific Computing</title>

    
    <link href="/scientific-computing/css/nucleus.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/fontawesome-all.min.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/hybrid.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/featherlight.min.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/perfect-scrollbar.min.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/auto-complete.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/atom-one-dark-reasonable.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/theme.css?1643906853" rel="stylesheet">
    <link href="/scientific-computing/css/hugo-theme.css?1643906853" rel="stylesheet">
    
    <link href="/scientific-computing/css/theme-dtc.css?1643906853" rel="stylesheet">
    
    

    <script src="/scientific-computing/js/jquery-3.3.1.min.js?1643906853"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
        });
    });
</script>



  </head>
  <body class="" data-url="/scientific-computing/unit_3_ode/01-am/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://sabs-r3.github.io/scientific-computing/">
    <img src="/scientific-computing/logos/SABSR3.svg" alt="SABSR3 logo">
</a>
  

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/scientific-computing/js/lunr.min.js?1643906853"></script>
<script type="text/javascript" src="/scientific-computing/js/auto-complete.js?1643906853"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/sabs-r3.github.io\/scientific-computing\/";
    
</script>
<script type="text/javascript" src="/scientific-computing/js/search.js?1643906853"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_0_introduction/" title="Course introduction" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_0_introduction/">
          Course introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/01_course_overview/" title="Course Overview" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/01_course_overview/">
        1. Course Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/02_course_activities/" title="Course Activities" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/02_course_activities/">
        2. Course Activities
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/03_getting_python/" title="Getting Python" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/03_getting_python/">
        3. Getting Python
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_1_linear_algebra/" title="Direct Solvers and Matrix Decompositions" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_1_linear_algebra/">
          <b>Day 1. </b>Direct Solvers and Matrix Decompositions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/" title="Matrix form of equations" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/">
        Matrix form of equations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/" title="Gaussian Elimination" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/">
        Gaussian Elimination
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/" title="Matrix decompositions" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/">
        Matrix decompositions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/" title="LU decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/">
        LU decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/" title="Cholesky decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/">
        Cholesky decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/" title="QR decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/">
        QR decomposition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_2_linear_algebra/">
          <b>Day 2. </b>Sparse Matrices and Iterative Solvers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/" title="Sparse matrices" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
        Sparse matrices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/">
        COOrdinate format
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/03-finite-difference/" title="Finite Difference Matrix" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/03-finite-difference/">
        Finite Difference Matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/" title="Scipy.sparse and problems" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/">
        Scipy.sparse and problems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/" title="Iterative methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/">
        Iterative methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/" title="Jacobi and Relaxation Methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/">
        Jacobi and Relaxation Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/" title="Krylov subspace methods and CG" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/">
        Krylov subspace methods and CG
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/" title="Iterative solvers in Scipy" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/">
        Iterative solvers in Scipy
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_3_ode/" title="Solving ODEs" class="dd-item
        parent
        
        
        ">
      <a href="/scientific-computing/unit_3_ode/">
          <b>Day 3. </b>Solving ODEs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/01-am/" title="ODE Solvers - AM exercise" class="dd-item active">
        <a href="/scientific-computing/unit_3_ode/01-am/">
        ODE Solvers - AM exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/02-pm/" title="ODE Solvers - PM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_3_ode/02-pm/">
        ODE Solvers - PM exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_4_optimisation/" title="Non-linear Optimisation" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_4_optimisation/">
          <b>Day 4. </b>Non-linear Optimisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/" title="Nonlinear Optimisation" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/">
        Nonlinear Optimisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/02-line-search-methods/">
        Line Search Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/03-trust-region-methods/" title="Trust Region Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
        Trust Region Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/">
        Derivative-free methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/05-finite-difference-method/" title="Finite difference method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
        Finite difference method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/06-nelder-mead/">
        Nelder-Mead method
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/" title="Applied Bayesian Inference" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_5_bayesian_inference/">
          <b>Day 5. </b>Applied Bayesian Inference
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/01-am/" title="Applied Bayesian Inference - AM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_5_bayesian_inference/01-am/">
        Applied Bayesian Inference - AM exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/02-pm/" title="Applied Bayesian Inference - PM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_5_bayesian_inference/02-pm/">
        Applied Bayesian Inference - PM exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_6_projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_6_projects/">
          <b>Day 6-8. </b>Projects
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_6_projects/01-project-description/" title="Project description" class="dd-item ">
        <a href="/scientific-computing/unit_6_projects/01-project-description/">
        Project description
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/SABS-R3/scientific-computing/blob/master/hugo_site/content/unit_3_ode/01-AM.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/scientific-computing/'></a> > <a href='/scientific-computing/unit_3_ode/'>Solving ODEs</a> > ODE Solvers - AM exercise
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              ODE Solvers - AM exercise
            </h1>
          

        


<p>The intentions behind this exercise are:</p>

<ul>
<li>To give you a clear goal to meet</li>
<li>To give you a chance to revise or learn a few things. Specifically:

<ul>
<li>The abstract base class pattern;</li>
<li>Unit testing with <code>unittest</code>;</li>
<li>Ordinary differential equation solver implementations.</li>
</ul></li>
</ul>

<p>A nice feature of this assignment is that you are provided with a testing infrastructure
which gives an
implicit specification of the code you are required to write. This means that when
you've written code
such that all the tests pass then you will know that you have completed the exercise.</p>

<h3 id="getting-the-code-for-these-exercises">Getting the code for these exercises</h3>

<p>Download the file <a href="/scientific-computing/ODEsAM.zip">ODEsAM.zip</a>. You have been
provided with one source class (<code>AbstractOdeSolver</code>) and with two test files.
You will not need to edit any of these 3 source files. If you do make edits to
them during the course of the exercise then make sure that your final version
works with the original versions of these files.</p>


<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>Running first test</strong>:</p>

<p>Check to see what running the simplest test-suite  <code>TestOdeSolvers.py</code> does at this
stage. It should stop with <code>ModuleNotFoundError: No module named 
'ForwardEulerOdeSolver'</code>. In order for the test to run, you need to create the
<code>ForwardEulerOdeSolver</code> class in <code>ForwardEulerOdeSolver.py</code>. This class should
inherit from <code>AbstractOdeSolver</code>, and should provide the one method:
<code>Solve()</code>. (This method's implementation does not yet have to contain any code
other than <code>pass</code>.) Now check that the <code>TestOdeSolvers.py</code> test-suite runs. It
is expected to throw exceptions at this stage.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> AbstractOdeSolver <span style="color:#f92672">import</span> AbstractOdeSolver <span style="color:#75715e"># Abstract base class</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ForwardEulerOdeSolver</span>(AbstractOdeSolver):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Solve</span>(self): <span style="color:#66d9ef">pass</span></code></pre></div>
<p>This answer is just for completeness.  There's nothing to this part
apart from a warm-up.</p>

</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>Writing a forward Euler solver</strong>:</p>

<p>The good news is that 1 out of 3 of the tests in the <code>TestOdeSolvers</code> test-suite
pass immediately.  The first test <code>test_abstract_class_methods</code> verifies that
all the functionality I have written in the abstract base class works and
consequently the test passes. The other two tests which check
<code>ForwardEulerOdeSolver.Solve()</code> works correctly are the tests which are failing.
If you need a revision tutorial about the Forward Euler method then please ask
now.</p>

<p>Your task is to implement the <code>Solve()</code>  method so that it solves from the
initial values over a time-interval with a fixed time step using forward Euler.
On exit from the method you should have populated <code>solutionTrace</code> with a list of
$(x,y)$ values (as pairs/tuples) and <code>timeTrace</code> with the list of corresponding
times.  The test-suite uses two simple model ordinary differential 2-d systems
of equations. These are plugged into the solver as right-hand side functions.
They are defined at the top of the test-suite file and both have straightforward<br>
analytic solutions.</p>

<p>As you develop your <code>Solve()</code> method you should reduce the number of failing
lines. One or two of the test lines are harder to satisfy than others. Attempt
to have no failures but the fewer the better. Please make sure that you have
comments in your code.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <p>Here's a version which first builds the lists to the correct length and then
writes in using indexing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Solve</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34; The forward Euler solve method &#34;&#34;&#34;</span>
        <span style="color:#75715e"># Fulfil the &#34;throw if not setup&#34; test</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>numberOfTimeSteps <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> :
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Timestepper not set up&#34;</span>)

        <span style="color:#75715e"># There&#39;s a test which runs the Solve method twice</span>
        <span style="color:#75715e"># and checks that the data from the first run is erased</span>
        self<span style="color:#f92672">.</span>solutionTrace<span style="color:#f92672">=</span>[None]<span style="color:#f92672">*</span>(self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>timeTrace<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)

        <span style="color:#75715e"># Initial state is recorded</span>
        self<span style="color:#f92672">.</span>solutionTrace[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialValues
        self<span style="color:#f92672">.</span>timeTrace[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime

        <span style="color:#75715e"># Set up loop variables</span>
        time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime
        values <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialValues

        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, self<span style="color:#f92672">.</span>numberOfTimeSteps):
            <span style="color:#75715e"># Euler step</span>
            dvdt <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>rhsFunction(values, time)
            x <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">0</span>]
            y <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">1</span>]

            <span style="color:#75715e"># Update solution and time to new values</span>
            values <span style="color:#f92672">=</span> (x,y)
            time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime <span style="color:#f92672">+</span> (i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>timeStepSize;
            self<span style="color:#f92672">.</span>solutionTrace[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> values
            self<span style="color:#f92672">.</span>timeTrace[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> time</code></pre></div>
<p>Here's an outline of a version with appends to the back of the lists.
This code also illustrates where testing may fail if the time-stepper uses
repeated addition.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">        <span style="color:#75715e"># Initial state is recorded</span>
        self<span style="color:#f92672">.</span>solutionTrace<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>initialValues)
        self<span style="color:#f92672">.</span>timeTrace<span style="color:#f92672">.</span>append(self<span style="color:#f92672">.</span>startTime)
        <span style="color:#75715e"># Set up loop variables</span>
        time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime
        accumulated_time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime  <span style="color:#75715e"># Wrong way to do this</span>
        values <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialValues

        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, self<span style="color:#f92672">.</span>numberOfTimeSteps):
            <span style="color:#f92672">...</span>
            <span style="color:#75715e"># Update solution and time to new values</span>
            values <span style="color:#f92672">=</span> (x,y)
            time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime <span style="color:#f92672">+</span> (i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>timeStepSize;
            accumulated_time <span style="color:#f92672">+=</span> self<span style="color:#f92672">.</span>timeStepSize; <span style="color:#75715e"># Wrong way to do this</span>
            self<span style="color:#f92672">.</span>solutionTrace<span style="color:#f92672">.</span>append(values);
            self<span style="color:#f92672">.</span>timeTrace<span style="color:#f92672">.</span>append(accumulated_time)
            <span style="color:#f92672">...</span></code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>Writing a better solver</strong>:</p>

<p>Now run <code>TestHigherOrderOdeSolverRunner</code>.  This new test-suite
requires you make another class <code>HigherOrderOdeSolver.py</code> which should
again provide  only a <code>Solve()</code> method. It tests the convergence behaviour of
your two solvers and checks that the higher-order one is better. My model answer
(which passes the test) uses a standard second order Runge-Kutta method. Again
work on your solution until there are few lines (ideally no lines) of failing
tests.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HigherOrderOdeSolver</span>(AbstractOdeSolver):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Solve</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;This is a Runge-Kutta (RK2) solve method&#34;&#34;&#34;</span>
        <span style="color:#75715e"># Fulfil the &#34;throw if not setup&#34; test</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>numberOfTimeSteps <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> :
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Timestepper not set up&#34;</span>)

        <span style="color:#75715e"># There&#39;s a test which runs the Solve method twice</span>
        <span style="color:#75715e"># and checks that the data from the first run is erased</span>
        self<span style="color:#f92672">.</span>solutionTrace<span style="color:#f92672">=</span>[None]<span style="color:#f92672">*</span>(self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>timeTrace<span style="color:#f92672">=</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)

        <span style="color:#75715e"># Initial state is recorded</span>
        self<span style="color:#f92672">.</span>solutionTrace[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialValues
        self<span style="color:#f92672">.</span>timeTrace[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime

        <span style="color:#75715e"># Set up loop variables</span>
        time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime
        values <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>initialValues

        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, self<span style="color:#f92672">.</span>numberOfTimeSteps):
            <span style="color:#75715e">#  Use gradient to get halfway point</span>
            dvdt <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>rhsFunction(values, time)
            halfwayx <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">/</span><span style="color:#ae81ff">2.0</span>
            halfwayy <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">/</span><span style="color:#ae81ff">2.0</span>

            <span style="color:#75715e"># Recompute gradient at halfway point</span>
            dvdt <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>rhsFunction((halfwayx, halfwayy),
                                    time<span style="color:#f92672">+</span>(self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">/</span><span style="color:#ae81ff">2.0</span>))

            <span style="color:#75715e"># Use this new gradient to update from the original value</span>
            x <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">0</span>]
            y <span style="color:#f92672">=</span> values[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>timeStepSize<span style="color:#f92672">*</span>dvdt[<span style="color:#ae81ff">1</span>]

            <span style="color:#75715e"># Update solution and time to new values</span>
            values <span style="color:#f92672">=</span> (x,y)
            time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime <span style="color:#f92672">+</span> (i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>timeStepSize
            self<span style="color:#f92672">.</span>solutionTrace[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> values
            self<span style="color:#f92672">.</span>timeTrace[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> time</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>Using a library function</strong>:</p>

<p>Write a solver implementation which uses <code>scipy.integrate.odeint</code> at its core.<br>
You should be able to do this with very few lines of code, including just a
single call to <code>odeint</code>.  Test it in a similar way to the
<code>HigherOrderOdeSolver</code>, using progressively smaller time-steps.</p>

<ul>
<li>What do you notice about the reported error?<br></li>
<li>What control do you have over the error?</li>
</ul>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OdeIntOdeSolver</span>(AbstractOdeSolver):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Solve</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34; The solve method using scipy.integrate.odeint&#34;&#34;&#34;</span>
        <span style="color:#75715e"># Fulfil the &#34;throw if not setup&#34; test</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>numberOfTimeSteps <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> :
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>(<span style="color:#e6db74">&#34;Timestepper not set up&#34;</span>)
        stopT <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>startTime<span style="color:#f92672">+</span>self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">*</span>self<span style="color:#f92672">.</span>timeStepSize
        times <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(self<span style="color:#f92672">.</span>startTime,stopT,self<span style="color:#f92672">.</span>numberOfTimeSteps<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>timeTrace <span style="color:#f92672">=</span> list(times)
        self<span style="color:#f92672">.</span>solutionTrace <span style="color:#f92672">=</span>\
            odeint(self<span style="color:#f92672">.</span>rhsFunction, self<span style="color:#f92672">.</span>initialValues, times)</code></pre></div>
<p>With the default setting and the same test as before I get something
similar to:</p>
<pre><code>#step_size         euler_error         hi_error       oi_error
6.283185307179586  4.442882938158366  14.647777676841754 1.0706378471935034e-07
3.141592653589793  7.088890675779233  14.73085508342019  1.1477237333346198e-07
1.5707963267948966 6.5841823894717395 2.953368442233411  1.1211067003602387e-07
0.7853981633974483 3.103938595129146  0.4282090775868214 1.1392372439136046e-07</code></pre>
<p>This is because <code>odeint</code> has absolute and relative error tolerances
set and it uses adaptive time-steps <em>between</em> the time-steps
which we care about.  That means that the first $2\pi$ step around the
circle is about as accurate as the finer tests which follow it.</p>

<p>We can control the error by setting the error tolerances, with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> self<span style="color:#f92672">.</span>solutionTrace <span style="color:#f92672">=</span>\
     odeint(self<span style="color:#f92672">.</span>rhsFunction, self<span style="color:#f92672">.</span>initialValues, times, rtol<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-12</span>, atol<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-12</span>)</code></pre></div>
<p>we get:</p>
<pre><code>#step_size         euler_error         hi_error       oi_error
6.283185307179586  4.442882938158366  14.647777676841754 2.4189691882833333e-12
3.141592653589793  7.088890675779233  14.73085508342019  2.2407390802495764e-12
1.5707963267948966 6.5841823894717395 2.953368442233411  1.990068084042871e-12
0.7853981633974483 3.103938595129146  0.428209077586821  1.6920994988211508e-12</code></pre>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>[Extension]</strong> Use the test output in <code>TestHigherOrderOdeSolver</code> as the
model for plotting convergence behaviour for these two solvers and at
least one other solver that you should write. Use <code>matplotlib</code> or some other
plotting program to make a log-log plot with time-step on the x-axis and error
on the y-axis.</p>

</div>



<div class="notices question" >
  <div class="label">Question</div>
  <p><strong>[Extension]</strong>  If you love <code>C++</code> then you are welcome to investigate coding ODE
solvers in C++ by investigating the assignment which formed the basis of this exercise:
<a href="https://www.cs.ox.ac.uk/people/joe.pitt-francis/oxfordonly/FridayAssignment.pdf">https://www.cs.ox.ac.uk/people/joe.pitt-francis/oxfordonly/FridayAssignment.pdf</a></p>

</div>



<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/scientific-computing/unit_3_ode/" title="Solving ODEs"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/scientific-computing/unit_3_ode/02-pm/" title="ODE Solvers - PM exercise" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/scientific-computing/js/clipboard.min.js?1643906853"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.min.js?1643906853"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.jquery.min.js?1643906853"></script>
    <script src="/scientific-computing/js/jquery.sticky.js?1643906853"></script>
    <script src="/scientific-computing/js/featherlight.min.js?1643906853"></script>
    <script src="/scientific-computing/js/highlight.pack.js?1643906853"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/scientific-computing/js/modernizr.custom-3.6.0.js?1643906853"></script>
    <script src="/scientific-computing/js/learn.js?1643906853"></script>
    <script src="/scientific-computing/js/hugo-learn.js?1643906853"></script>
    
    

  </body>
</html>

