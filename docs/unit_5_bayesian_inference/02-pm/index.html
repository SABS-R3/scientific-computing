<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="description" content="An online course on Modelling and Scientific Computing in Python for the SABS:R3 Centre for Doctoral Training https://www.sabsr3.ox.ac.uk/">
<meta name="author" content="Martin Robinson">

    <link rel="shortcut icon" href="/ScientificComputingInMatlab/logos/dtc_hex.svg" type="image/x-icon" />

    <title>Applied Bayesian Inference - PM exercise   Modelling and Scientific Computing</title>

    
    <link href="/scientific-computing/css/nucleus.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/fontawesome-all.min.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/hybrid.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/featherlight.min.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/perfect-scrollbar.min.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/auto-complete.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/atom-one-dark-reasonable.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/theme.css?1643970176" rel="stylesheet">
    <link href="/scientific-computing/css/hugo-theme.css?1643970176" rel="stylesheet">
    
    <link href="/scientific-computing/css/theme-dtc.css?1643970176" rel="stylesheet">
    
    

    <script src="/scientific-computing/js/jquery-3.3.1.min.js?1643970176"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
        });
    });
</script>



  </head>
  <body class="" data-url="/scientific-computing/unit_5_bayesian_inference/02-pm/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://sabs-r3.github.io/scientific-computing/">
    <img src="/scientific-computing/logos/SABSR3.svg" alt="SABSR3 logo">
</a>
  

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/scientific-computing/js/lunr.min.js?1643970176"></script>
<script type="text/javascript" src="/scientific-computing/js/auto-complete.js?1643970176"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/sabs-r3.github.io\/scientific-computing\/";
    
</script>
<script type="text/javascript" src="/scientific-computing/js/search.js?1643970176"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_0_introduction/" title="Course introduction" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_0_introduction/">
          Course introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/01_course_overview/" title="Course Overview" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/01_course_overview/">
        1. Course Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/02_course_activities/" title="Course Activities" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/02_course_activities/">
        2. Course Activities
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/03_getting_python/" title="Getting Python" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/03_getting_python/">
        3. Getting Python
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_1_linear_algebra/" title="Direct Solvers and Matrix Decompositions" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_1_linear_algebra/">
          <b>Day 1. </b>Direct Solvers and Matrix Decompositions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/" title="Matrix form of equations" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/">
        Matrix form of equations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/" title="Gaussian Elimination" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/">
        Gaussian Elimination
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/" title="Matrix decompositions" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/">
        Matrix decompositions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/" title="LU decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/">
        LU decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/" title="Cholesky decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/">
        Cholesky decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/" title="QR decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/">
        QR decomposition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_2_linear_algebra/">
          <b>Day 2. </b>Sparse Matrices and Iterative Solvers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/" title="Sparse matrices" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
        Sparse matrices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/">
        COOrdinate format
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/03-finite-difference/" title="Finite Difference Matrix" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/03-finite-difference/">
        Finite Difference Matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/" title="Scipy.sparse and problems" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/">
        Scipy.sparse and problems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/" title="Iterative methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/">
        Iterative methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/" title="Jacobi and Relaxation Methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/">
        Jacobi and Relaxation Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/" title="Krylov subspace methods and CG" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/">
        Krylov subspace methods and CG
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/" title="Iterative solvers in Scipy" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/">
        Iterative solvers in Scipy
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_3_ode/" title="Solving ODEs" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_3_ode/">
          <b>Day 3. </b>Solving ODEs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/01-am/" title="ODE Solvers - AM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_3_ode/01-am/">
        ODE Solvers - AM exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/02-pm/" title="ODE Solvers - PM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_3_ode/02-pm/">
        ODE Solvers - PM exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_4_optimisation/" title="Non-linear Optimisation" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_4_optimisation/">
          <b>Day 4. </b>Non-linear Optimisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/" title="Nonlinear Optimisation" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/">
        Nonlinear Optimisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/02-line-search-methods/">
        Line Search Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/03-trust-region-methods/" title="Trust Region Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
        Trust Region Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/">
        Derivative-free methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/05-finite-difference-method/" title="Finite difference method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
        Finite difference method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/06-nelder-mead/">
        Nelder-Mead method
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/" title="Applied Bayesian Inference" class="dd-item
        parent
        
        
        ">
      <a href="/scientific-computing/unit_5_bayesian_inference/">
          <b>Day 5. </b>Applied Bayesian Inference
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/01-am/" title="Applied Bayesian Inference - AM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_5_bayesian_inference/01-am/">
        Applied Bayesian Inference - AM exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/02-pm/" title="Applied Bayesian Inference - PM exercise" class="dd-item active">
        <a href="/scientific-computing/unit_5_bayesian_inference/02-pm/">
        Applied Bayesian Inference - PM exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_6_projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_6_projects/">
          <b>Day 6-8. </b>Projects
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_6_projects/01-project-description/" title="Project description" class="dd-item ">
        <a href="/scientific-computing/unit_6_projects/01-project-description/">
        Project description
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/SABS-R3/scientific-computing/blob/master/hugo_site/content/unit_5_bayesian_inference/02-PM.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/scientific-computing/'></a> > <a href='/scientific-computing/unit_5_bayesian_inference/'>Applied Bayesian Inference</a> > Applied Bayesian Inference - PM exercise
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Applied Bayesian Inference - PM exercise
            </h1>
          

        


<h1 id="lotkavolterra">Lotka-Volterra</h1>

<p>In this practical, we are going to perform inference for the Lotka-Volterra model of population dynamics. The model describes the dynamics of population sizes of prey ($u(t)$) and predators ($v(t)$), where, here, $t$ denotes a given time in years. These equations are given by:</p>

<p><span  class="math">\[
\begin{aligned}
\frac{d u}{dt} &= \alpha u - \beta u v\\
\frac{d v}{dt} &= -\gamma v + \delta u v
\end{aligned}
\]</span></p>

<p>where at time $t=0$, $u(0) = u_0$ and $v(0)=v_0$. Here, $\alpha\geq 0$ yields the prey population growth rate in the absence of predators; $\beta \geq 0$ is the rate of decline in the prey as a result of predation; $\gamma \geq 0$ denotes the rate of decline of predators in absence of prey; $\delta &gt; 0$ is the rate of predator population growth due to predation.</p>

<h2 id="preliminary-question">Preliminary question!</h2>

<p>Have you got PINTS installed on your machine? If not, clone the PINTS repo on: <a href="https://github.com/pints-team/pints">https://github.com/pints-team/pints</a> and install it by executing:</p>

<p><code>pip install -e .[dev,docs]</code></p>

<p>on the terminal in the PINTS main directory. (If you want to avoid clashes with any local installed packages, you may want to use a virtual environment.)</p>


<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-1">1.</h2>

<p>Write a function which solves these two equations for any choice of $(\alpha, \beta, \gamma, \delta, u_0, v_0)$. Plot the solutions for $\alpha=0.55, \beta=0.028, \gamma=0.84, \delta=0.026, u_0=33, v_0=6$.</p>

<p>Code up the RHS of equations and use numerical solver.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lotka_volterra_rhs</span>(y, t, alpha, beta, gamma, delta):
    u, v <span style="color:#f92672">=</span> y
    dydt <span style="color:#f92672">=</span> [alpha <span style="color:#f92672">*</span> u <span style="color:#f92672">-</span> beta <span style="color:#f92672">*</span> u <span style="color:#f92672">*</span> v, <span style="color:#f92672">-</span>gamma <span style="color:#f92672">*</span> v <span style="color:#f92672">+</span> delta <span style="color:#f92672">*</span> u <span style="color:#f92672">*</span> v]
    <span style="color:#66d9ef">return</span> dydt</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> scipy.integrate <span style="color:#f92672">import</span> odeint
<span style="color:#f92672">from</span> plotnine <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lotka_volterra_solve</span>(times, alpha, beta, gamma, delta, u_0, v_0):
    sol <span style="color:#f92672">=</span> odeint(lotka_volterra_rhs, [u_0, v_0], times, args<span style="color:#f92672">=</span>(alpha, beta, gamma, delta))
    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;t&#39;</span>: times, <span style="color:#e6db74">&#39;u&#39;</span>: sol[:, <span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#39;v&#39;</span>: sol[:, <span style="color:#ae81ff">1</span>]})
    <span style="color:#66d9ef">return</span> df

times <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">1001</span>)

df <span style="color:#f92672">=</span> lotka_volterra_solve(times, <span style="color:#ae81ff">0.55</span>, <span style="color:#ae81ff">0.028</span>, <span style="color:#ae81ff">0.84</span>, <span style="color:#ae81ff">0.026</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>)
df_long <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>melt(df, id_vars<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;t&#39;</span>)

(ggplot(df_long, aes(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;t&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;value&#39;</span>, colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;variable&#39;</span>)) <span style="color:#f92672">+</span>
 geom_line())</code></pre></div>
<p>An alternative way to view this is as orbits.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(ggplot(df, aes(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;v&#39;</span>)) <span style="color:#f92672">+</span>
 geom_path())</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-2">2.</h2>

<p>Run the model with $\alpha=0.79, \beta=0.04, \gamma=1.3, \delta=0.04, u_0=33, v_0=6$. How do the dynamics compare with previous?</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df1 <span style="color:#f92672">=</span> lotka_volterra_solve(times, <span style="color:#ae81ff">0.79</span>, <span style="color:#ae81ff">0.04</span>, <span style="color:#ae81ff">1.3</span>, <span style="color:#ae81ff">0.04</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>)
df1[<span style="color:#e6db74">&#39;simulation&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2&#39;</span>
df[<span style="color:#e6db74">&#39;simulation&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span>
df_both <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df, df1])

(ggplot(df_both, aes(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;v&#39;</span>, colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;simulation&#39;</span>)) <span style="color:#f92672">+</span>
 geom_path())</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-3">3.</h2>

<p>Suppose that the observations for each population are governed by the following:</p>

<p><span  class="math">\[
\begin{aligned}
\tilde u &= u \exp(\epsilon_u)\\
\tilde v &= v \exp(\epsilon_v)
\end{aligned}
\]</span></p>

<p>where $\epsilon_u\sim\mathcal{N}(0, \sigma_u)$ and $\epsilon_v\sim\mathcal{N}(0, \sigma_v)$. Show that these are equivalent to:</p>

<p><span  class="math">\[
\begin{aligned}
\tilde u &\sim \text{log-normal}(\log u, \sigma_u)\\
\tilde v &\sim \text{log-normal}(\log v, \sigma_v)\\
\end{aligned}
\]</span></p>

</div>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-4">4.</h2>

<p>Using these observation models, generate annual data for 25 years assuming $\sigma_u=\sigma_v=0.25$ and using the parameter sets from parts 1 and 2. Graph these observations.</p>

<p>Note, this may be a helpful resource: <a href="https://ben18785.shinyapps.io/distribution-zoo/">https://ben18785.shinyapps.io/distribution-zoo/</a></p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">observations</span>(df, sigma_u, sigma_v):
    u_tilde <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(len(df))
    v_tilde <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(len(df))
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(u_tilde)):
        u_tilde[i] <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>stats<span style="color:#f92672">.</span>lognorm<span style="color:#f92672">.</span>rvs(scale<span style="color:#f92672">=</span>df[<span style="color:#e6db74">&#39;u&#39;</span>][i], s<span style="color:#f92672">=</span>sigma_u, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
        v_tilde[i] <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>stats<span style="color:#f92672">.</span>lognorm<span style="color:#f92672">.</span>rvs(scale<span style="color:#f92672">=</span>df[<span style="color:#e6db74">&#39;v&#39;</span>][i], s<span style="color:#f92672">=</span>sigma_v, size<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
    df[<span style="color:#e6db74">&#39;u_tilde&#39;</span>] <span style="color:#f92672">=</span> u_tilde
    df[<span style="color:#e6db74">&#39;v_tilde&#39;</span>] <span style="color:#f92672">=</span> v_tilde
    <span style="color:#66d9ef">return</span> df

times <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">1</span>)
df <span style="color:#f92672">=</span> lotka_volterra_solve(times, <span style="color:#ae81ff">0.55</span>, <span style="color:#ae81ff">0.028</span>, <span style="color:#ae81ff">0.84</span>, <span style="color:#ae81ff">0.026</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>)
df <span style="color:#f92672">=</span> observations(df, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.25</span>)
df[<span style="color:#e6db74">&#39;simulation&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span>
df1 <span style="color:#f92672">=</span> lotka_volterra_solve(times, <span style="color:#ae81ff">0.9</span>, <span style="color:#ae81ff">0.04</span>, <span style="color:#ae81ff">1.3</span>, <span style="color:#ae81ff">0.04</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>)
df1 <span style="color:#f92672">=</span> observations(df1, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.25</span>)
df1[<span style="color:#e6db74">&#39;simulation&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2&#39;</span>

df_both <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df, df1])

(ggplot(df_both, aes(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u_tilde&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;v_tilde&#39;</span>, colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;simulation&#39;</span>)) <span style="color:#f92672">+</span>
 geom_path() <span style="color:#f92672">+</span>
 geom_point())</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-5">5.</h2>

<p>The likelihood for the prey compartment is given by:</p>

<p><span  class="math">\[
L_u = \prod_{t=1}^{T} \text{log-normal}(\tilde u(t)| \log u(t|\alpha, \beta, \gamma, \delta, u_0, v_0), \sigma_u)
\]</span></p>

<p>with a similar expression for the predator compartment. Here $u(t|\alpha, \beta, \gamma, \delta, u_0, v_0)$ is the solution of the Lotka-Volterra eqns. Write a function which calculates the log-likelihood of a set of observations with given values of $(\alpha, \beta, \gamma, \delta, u_0, v_0, \sigma_u, \sigma_v)$.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lotka_volterra_u_loglikelihood</span>(df_obs, alpha, beta, gamma, delta, u_0, v_0, sigma_u, sigma_v): 
    df <span style="color:#f92672">=</span> lotka_volterra_solve(df_obs[<span style="color:#e6db74">&#39;t&#39;</span>], alpha, beta, gamma, delta, u_0, v_0)
    log_p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(df_obs[<span style="color:#e6db74">&#39;t&#39;</span>])):
        log_p <span style="color:#f92672">+=</span> scipy<span style="color:#f92672">.</span>stats<span style="color:#f92672">.</span>lognorm<span style="color:#f92672">.</span>logpdf(df_obs[<span style="color:#e6db74">&#39;u_tilde&#39;</span>][i], scale<span style="color:#f92672">=</span>df[<span style="color:#e6db74">&#39;u&#39;</span>][i], s<span style="color:#f92672">=</span>sigma_u)
        log_p <span style="color:#f92672">+=</span> scipy<span style="color:#f92672">.</span>stats<span style="color:#f92672">.</span>lognorm<span style="color:#f92672">.</span>logpdf(df_obs[<span style="color:#e6db74">&#39;v_tilde&#39;</span>][i], scale<span style="color:#f92672">=</span>df[<span style="color:#e6db74">&#39;v&#39;</span>][i], s<span style="color:#f92672">=</span>sigma_v)
    <span style="color:#66d9ef">return</span> log_p</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-6">6.</h2>

<p>Using the first of the series generated in question 4, plot a 1D slice through the log-likelihood surface for $\alpha$ whilst holding the other parameters $\beta=0.028, \gamma=0.84, \delta=0.026, u_0=33, v_0=6, \sigma_u=0.25, \sigma_v=0.25$. In this slice, how close is $\alpha$ to its true value?</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
alpha <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>)
log_like <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(len(alpha))
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(alpha)):
    log_like[i] <span style="color:#f92672">=</span> lotka_volterra_u_loglikelihood(df, alpha[i], <span style="color:#ae81ff">0.028</span>, <span style="color:#ae81ff">0.84</span>, <span style="color:#ae81ff">0.026</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.25</span>)
plt<span style="color:#f92672">.</span>plot(alpha, log_like)
plt<span style="color:#f92672">.</span>show()</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-7">7.</h2>

<p>PINTS is a Python package designed in the Department of Computer Science that provides access to all sorts of inference routines, which is especially good for ODEs. Following the approach given here: <a href="https://github.com/pints-team/pints/blob/master/examples/stats/custom-model.ipynb">https://github.com/pints-team/pints/blob/master/examples/stats/custom-model.ipynb</a> wrap wrap a pints.LogPDF class around the log-likelihood function we just created to allow us to access these methods. We're going to hold a number of parameters constant to make inference a little more manageable for this practical, so set up your method with $(u_0=33, v_0=6, \sigma_u=0.25, \sigma_v=0.25)$.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pints

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LotkaVolterraLogPDF</span>(pints<span style="color:#f92672">.</span>LogPDF):
    <span style="color:#66d9ef">def</span> __init__(self, df_obs, u0<span style="color:#f92672">=</span><span style="color:#ae81ff">33</span>, v0<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>, sigma_u<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, sigma_v<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>):
        self<span style="color:#f92672">.</span>_df_obs <span style="color:#f92672">=</span> df_obs
        self<span style="color:#f92672">.</span>_u0 <span style="color:#f92672">=</span> u0
        self<span style="color:#f92672">.</span>_v0 <span style="color:#f92672">=</span> v0
        self<span style="color:#f92672">.</span>_sigma_u <span style="color:#f92672">=</span> sigma_u
        self<span style="color:#f92672">.</span>_sigma_v <span style="color:#f92672">=</span> sigma_v

    <span style="color:#66d9ef">def</span> __call__(self, x):
        df_obs <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_df_obs
        u0 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_u0
        v0 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_v0
        sigma_u <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_sigma_u
        sigma_v <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_sigma_v
        <span style="color:#66d9ef">return</span> lotka_volterra_u_loglikelihood(df_obs, x[<span style="color:#ae81ff">0</span>], x[<span style="color:#ae81ff">1</span>], x[<span style="color:#ae81ff">2</span>], x[<span style="color:#ae81ff">3</span>],
                                              u0, v0, sigma_u, sigma_v)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">n_parameters</span>(self):
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">4</span></code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-8">8.</h2>

<p>We now are going to use an inbuilt MCMC method in PINTS called <code>HaarioBardenetACMC</code> to generate posterior samples with 2000 iterations per chain and 200 initial phase iterations across 4 chains. To initialise each of the chains assume:</p>

<p>$(\alpha=0.6, \beta=0.02, \gamma=1.0, \delta=0.03)$</p>

<p>which can be done using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nchains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
xs <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0.6</span>, <span style="color:#ae81ff">0.02</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.03</span>]] <span style="color:#f92672">*</span> nchains</code></pre></div>
<p>Note, initialising chains all at a single point is not good practive but allows us to get up and running faster.</p>

<p>To run the MCMC, we first instantiate the pints.LogPDF object you created in the previous question assuming observational data generated in question 4. Then we instantiate an MCMC Controller object using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mcmc <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCController(model, nchains, xs, method<span style="color:#f92672">=</span>pints<span style="color:#f92672">.</span>HaarioBardenetACMC)</code></pre></div>
<p>where <code>model</code> is an instantiated version of your model. Then we set the total number of iterations per chain and the initial phase iterations using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mcmc<span style="color:#f92672">.</span>set_max_iterations(<span style="color:#ae81ff">2000</span>)
mcmc<span style="color:#f92672">.</span>set_initial_phase_iterations(<span style="color:#ae81ff">200</span>)</code></pre></div>
<p>Finally, we execute:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">chains <span style="color:#f92672">=</span> mcmc<span style="color:#f92672">.</span>run()</code></pre></div>
<p>to run the MCMC.</p>

<p>Note that, at the moment, since we have not specified priors, PINTS implicitly assumes that the priors are uniform (and, in this case, improper).</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">model <span style="color:#f92672">=</span> LotkaVolterraLogPDF(df)
nchains <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
xs <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0.6</span>, <span style="color:#ae81ff">0.02</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.03</span>]]<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>
mcmc <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCController(model, nchains, xs, method<span style="color:#f92672">=</span>pints<span style="color:#f92672">.</span>HaarioBardenetACMC)

<span style="color:#75715e"># Add stopping criterion</span>
mcmc<span style="color:#f92672">.</span>set_max_iterations(<span style="color:#ae81ff">2000</span>)

<span style="color:#75715e"># Start adapting after 1000 iterations</span>
mcmc<span style="color:#f92672">.</span>set_initial_phase_iterations(<span style="color:#ae81ff">200</span>)
chains <span style="color:#f92672">=</span> mcmc<span style="color:#f92672">.</span>run()</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-9">9.</h2>

<p>PINTS has an in-built MCMC summary object that can be called and printed using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCSummary(chains<span style="color:#f92672">=</span>chains, time<span style="color:#f92672">=</span>mcmc<span style="color:#f92672">.</span>time())
<span style="color:#66d9ef">print</span>(results)</code></pre></div>
<p>Have your MCMC chains yet converged? If Rhat &gt; 1.1 (probably 1.01 for publications), for any of your parameters, in practice you would rerun for more iterations. Since we only have a little time today, we won't rerun things.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCSummary(chains<span style="color:#f92672">=</span>chains, time<span style="color:#f92672">=</span>mcmc<span style="color:#f92672">.</span>time())
<span style="color:#66d9ef">print</span>(results)</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-10">10.</h2>

<p>Using PINTS' plotting tools (see: <a href="https://github.com/pints-team/pints/blob/master/examples/sampling/adaptive-covariance-haario-bardenet.ipynb">https://github.com/pints-team/pints/blob/master/examples/sampling/adaptive-covariance-haario-bardenet.ipynb</a>) plot pairwise samples from the parameters. Before we do that, let's discard the first half of the chains as these are likely before convergence occurred.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pints.plot

<span style="color:#75715e"># Look at distribution across all chains</span>
pints<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>pairwise(np<span style="color:#f92672">.</span>vstack(chains[:, <span style="color:#ae81ff">1000</span>:]), kde<span style="color:#f92672">=</span>False)

<span style="color:#75715e"># Show graphs</span>
plt<span style="color:#f92672">.</span>show()</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-11">11.</h2>

<p>Why is there positive correlation between the estimates of $\alpha$ and $\beta$?</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <p>Examining the equation:</p>

<p>$\frac{d u}{dt} = \alpha u - \beta u v$,</p>

<p>we see that if $\alpha\uparrow$ then $\frac{d u}{dt}\uparrow$. So, if $\beta\uparrow$ too, then $\frac{d u}{dt}$ can remain approximately constant, and the dynamics of the system would remain unchanged. In other words, the same observed data sample can be obtained in more than one way.</p>

</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-12">12.</h2>

<p>Using a randomly drawn subset of 100 posterior draws, generate posterior predictive draws of the mean predator and prey numbers of time. Then plot these, overlaying the data. Why do the posterior predictive simulations not encompass all the variation seen in the data?</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">chains_long <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack(chains[:, <span style="color:#ae81ff">1000</span>:])
nsamples <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
idx <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(len(chains_long), size<span style="color:#f92672">=</span>nsamples)
chains_long <span style="color:#f92672">=</span> chains_long[idx, ]
times <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">1001</span>)


<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(nsamples):
    temp <span style="color:#f92672">=</span> lotka_volterra_solve(times,
                                chains_long[i, <span style="color:#ae81ff">0</span>], chains_long[i, <span style="color:#ae81ff">1</span>],
                                chains_long[i, <span style="color:#ae81ff">2</span>], chains_long[i, <span style="color:#ae81ff">3</span>],
                                <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">6</span>)
    temp[<span style="color:#e6db74">&#39;replicate&#39;</span>] <span style="color:#f92672">=</span> str(i)
    <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        big_df <span style="color:#f92672">=</span> temp
    <span style="color:#66d9ef">else</span>:
        big_df <span style="color:#f92672">=</span> big_df<span style="color:#f92672">.</span>append(temp)</code></pre></div>
<p>Combine datasets.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[<span style="color:#e6db74">&#39;type&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;observations&#39;</span>
big_df[<span style="color:#e6db74">&#39;type&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;simulations&#39;</span>
big_df1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df, big_df])</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(ggplot(big_df1<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;type==&#34;simulations&#34;&#39;</span>), aes(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;t&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u&#39;</span>)) <span style="color:#f92672">+</span>
 geom_line(aes(group<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;replicate&#39;</span>), alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>) <span style="color:#f92672">+</span>
 geom_point(big_df1<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;type==&#34;observations&#34;&#39;</span>), 
            aes(y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;u_tilde&#39;</span>), colour<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;orange&#39;</span>))</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <h2 id="section-13">13.</h2>

<p>We are now going to initialise the chains randomly, which is better practice since it is less likely the chains will be biased to a particular area of parameter space. To do this, we are going to create a <code>UniformLogPrior</code> object in PINTS, then use the <code>sample()</code> method to generate independent draws for each parameter across each chain. To do this, we are going to use the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">log_prior <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>UniformLogPrior([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">0.2</span>])</code></pre></div>
<p>Using this <code>log_prior</code> object, sample initial positions for the chains and re-run the MCMC sampling as above. Afterwards, plot the path of the chains over time and compute convergence measures. Do the chains look as close to convergence as before?</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">log_prior <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>UniformLogPrior([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>],
                                  [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">0.2</span>])
xs <span style="color:#f92672">=</span> log_prior<span style="color:#f92672">.</span>sample(nchains)
mcmc <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCController(model, nchains, xs, method<span style="color:#f92672">=</span>pints<span style="color:#f92672">.</span>HaarioBardenetACMC)

<span style="color:#75715e"># Add stopping criterion</span>
mcmc<span style="color:#f92672">.</span>set_max_iterations(<span style="color:#ae81ff">2000</span>)

<span style="color:#75715e"># Start adapting after 1000 iterations</span>
mcmc<span style="color:#f92672">.</span>set_initial_phase_iterations(<span style="color:#ae81ff">200</span>)
chains <span style="color:#f92672">=</span> mcmc<span style="color:#f92672">.</span>run()</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">results <span style="color:#f92672">=</span> pints<span style="color:#f92672">.</span>MCMCSummary(chains<span style="color:#f92672">=</span>chains, time<span style="color:#f92672">=</span>mcmc<span style="color:#f92672">.</span>time())
<span style="color:#66d9ef">print</span>(results)</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pints.plot

pints<span style="color:#f92672">.</span>plot<span style="color:#f92672">.</span>trace(chains)
plt<span style="color:#f92672">.</span>show()</code></pre></div>
</div>

</details>



<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/scientific-computing/unit_5_bayesian_inference/01-am/" title="Applied Bayesian Inference - AM exercise"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/scientific-computing/unit_6_projects/" title="Projects" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/scientific-computing/js/clipboard.min.js?1643970176"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.min.js?1643970176"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.jquery.min.js?1643970176"></script>
    <script src="/scientific-computing/js/jquery.sticky.js?1643970176"></script>
    <script src="/scientific-computing/js/featherlight.min.js?1643970176"></script>
    <script src="/scientific-computing/js/highlight.pack.js?1643970176"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/scientific-computing/js/modernizr.custom-3.6.0.js?1643970176"></script>
    <script src="/scientific-computing/js/learn.js?1643970176"></script>
    <script src="/scientific-computing/js/hugo-learn.js?1643970176"></script>
    
    

  </body>
</html>

