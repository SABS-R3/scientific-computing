<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="description" content="An online course on Modelling and Scientific Computing in Python for the SABS:R3 Centre for Doctoral Training https://www.sabsr3.ox.ac.uk/">
<meta name="author" content="Martin Robinson">

    <link rel="shortcut icon" href="/ScientificComputingInMatlab/logos/dtc_hex.svg" type="image/x-icon" />

    <title>Finite difference method   Modelling and Scientific Computing</title>

    
    <link href="/scientific-computing/css/nucleus.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/fontawesome-all.min.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/hybrid.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/featherlight.min.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/perfect-scrollbar.min.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/auto-complete.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/atom-one-dark-reasonable.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/theme.css?1611598308" rel="stylesheet">
    <link href="/scientific-computing/css/hugo-theme.css?1611598308" rel="stylesheet">
    
    <link href="/scientific-computing/css/theme-dtc.css?1611598308" rel="stylesheet">
    
    

    <script src="/scientific-computing/js/jquery-3.3.1.min.js?1611598308"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
        });
    });
</script>



  </head>
  <body class="" data-url="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://sabs-r3.github.io/scientific-computing/">
    <img src="/scientific-computing/logos/SABSR3.svg" alt="SABSR3 logo">
</a>
  

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/scientific-computing/js/lunr.min.js?1611598308"></script>
<script type="text/javascript" src="/scientific-computing/js/auto-complete.js?1611598308"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/sabs-r3.github.io\/scientific-computing\/";
    
</script>
<script type="text/javascript" src="/scientific-computing/js/search.js?1611598308"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_0_introduction/" title="Course introduction" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_0_introduction/">
          Course introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/01_course_overview/" title="Course Overview" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/01_course_overview/">
        1. Course Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/02_course_activities/" title="Course Activities" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/02_course_activities/">
        2. Course Activities
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/03_getting_python/" title="Getting Python" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/03_getting_python/">
        3. Getting Python
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_1_linear_algebra/" title="Direct Solvers and Matrix Decompositions" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_1_linear_algebra/">
          <b>Day 1. </b>Direct Solvers and Matrix Decompositions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/" title="Matrix form of equations" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/">
        Matrix form of equations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/" title="Gaussian Elimination" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/">
        Gaussian Elimination
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/" title="Matrix decompositions" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/">
        Matrix decompositions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/" title="LU decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/">
        LU decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/" title="Cholesky decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/">
        Cholesky decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/" title="QR decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/">
        QR decomposition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_2_linear_algebra/">
          <b>Day 2. </b>Sparse Matrices and Iterative Solvers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/" title="Sparse matrices" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
        Sparse matrices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/">
        COOrdinate format
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/03-finite-difference/" title="Finite Difference Matrix" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/03-finite-difference/">
        Finite Difference Matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/" title="Scipy.sparse and problems" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/">
        Scipy.sparse and problems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/" title="Iterative methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/">
        Iterative methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/" title="Jacobi and Relaxation Methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/">
        Jacobi and Relaxation Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/" title="Krylov subspace methods and CG" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/">
        Krylov subspace methods and CG
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/" title="Iterative solvers in Scipy" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/">
        Iterative solvers in Scipy
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_3_ode/" title="Solving ODEs" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_3_ode/">
          <b>Day 3. </b>Solving ODEs
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_4_optimisation/" title="Non-linear Optimisation" class="dd-item
        parent
        
        
        ">
      <a href="/scientific-computing/unit_4_optimisation/">
          <b>Day 4. </b>Non-linear Optimisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/" title="Nonlinear Optimisation" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/">
        Nonlinear Optimisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/02-line-search-methods/">
        Line Search Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/03-trust-region-methods/" title="Trust Region Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
        Trust Region Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/">
        Derivative-free methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/05-finite-difference-method/" title="Finite difference method" class="dd-item active">
        <a href="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
        Finite difference method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/06-nelder-mead/">
        Nelder-Mead method
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/" title="Bayesian Inference" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_5_bayesian_inference/">
          <b>Day 5. </b>Bayesian Inference
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_6_projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_6_projects/">
          <b>Day 6-8. </b>Projects
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/SABS-R3/scientific-computing/blob/main/hugo_site/content/unit_4_optimisation/05-finite-difference-method.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/scientific-computing/'></a> > <a href='/scientific-computing/unit_4_optimisation/'>Non-linear Optimisation</a> > Finite difference method
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Finite difference method
            </h1>
          

        


<p>The simplest way of converting a gradient-based optimisation algorithm to a derivative
free one is to approximate the gradient of the function using finite differences.</p>

<p>The Finite Difference (FD) method is based on taking a Taylor series expansion of either
$f(x+h)$ and $f(x-h)$ (and others) for a small parameter $f$ about $x$. Consider a
smooth function $f(x)$ then its Taylor expansion is</p>

<p><span  class="math">\[f(x+h) = f(x) + h f'(x) + \frac{h^2}{2} f''(x) + \frac{h^3}{6} f'''(x) + \frac{h^4}{24} f'''''(x) + \ldots \]</span></p>

<p><span  class="math">\[f(x-h) = f(x) - h f'(x) + \frac{h^2}{2} f''(x) - \frac{h^3}{6} f'''(x) + \frac{h^4}{24} f'''''(x) - \ldots \]</span></p>

<p>From this, we can compute three different \emph{schemes} (approximations) to $u'(x)$:</p>

<p><strong>Forward difference</strong>:
<span  class="math">\(u'(x) = \frac{u(x+h)-u(x)}{h} + O(h)\)</span></p>

<p><strong>Backward difference</strong>:
<span  class="math">\(u'(x) = \frac{u(x)-u(x-h)}{h} + O(h)\)</span></p>

<p><strong>Centered difference</strong>:
<span  class="math">\(u'(x) = \frac{u(x+h)-u(x-h)}{2h} + O(h^2)\)</span></p>

<p>Finite difference approximations are easily computed, but suffer from innacuracies which
can cause optimisation algorithms to fail or perform poorely. As well as the error in
the FD approximation itself (e.g. $O(h^2)$ for centered difference), the function
evaluation itself might have some numerical or stochastic &quot;noise&quot;. If this noise
dominates over the (small) step size $h$, then it is entirely probable that the
calculated steepest descent $-\nabla f(x)$ will <strong>not</strong> be a direction of descent for
$f$.</p>

<h3 id="software">Software</h3>

<p>It is very common that optimisation libraries provide a finite difference approximation
to the Jacobian $\nabla f$ if it is not supplied, as is done for the gradient-based
methods in <a href="https://docs.scipy.org/doc/scipy/reference/optimize.html"><code>scipy.optimize</code></a>.</p>

<p>More dedicated libraries can give superior approximations to the gradient, like the
<a href="https://numdifftools.readthedocs.io/en/latest/index.html"><code>numdifftools</code></a> package. This
library provides higher order FD approximations and <em>Richardson extrapolation</em> to
evaluate the limit of $h \rightarrow 0$, and can calculate Jacobians and Hessians of
user-supplied functions.</p>

<h3 id="problems">Problems</h3>


<div class="notices question" >
  <div class="label">Question</div>
  <p>Use the following methods from
<a href="https://docs.scipy.org/doc/scipy/reference/optimize.html"><code>scipy.optimize</code></a> to minimize
the 2D <a href="https://en.wikipedia.org/wiki/Rosenbrock_function">Rosenbrock
function</a>:</p>

<ul>
<li>Nelder-Mead Simplex</li>
<li>Conjugate Gradient</li>
<li>BFGS Quasi-Newton</li>
<li>Newton-CG</li>
<li>SHG Global Optimisation</li>
</ul>

<p>Either use $x_0 = (−1.2, 1)^T$ as the starting point, or experiment with your own.</p>

<p>In each case perform the optimisation with and without a user-supplied jacobian and
evaluate the effect on the number of evaluations of the function $f$ required to
converge to the optimum. Optional: You can take the derivatives by hand, or use
automatic differentiation via the <a href="https://github.com/HIPS/autograd"><code>autograd</code></a> or
<a href="https://github.com/google/jax"><code>JAX</code></a> packages</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> autograd.numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> scipy.optimize <span style="color:#f92672">import</span> minimize, shgo
<span style="color:#f92672">from</span> autograd <span style="color:#f92672">import</span> grad

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convex_function</span>(x):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(np<span style="color:#f92672">.</span>array(x)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rosenbrock</span>(x):
    a <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    b <span style="color:#f92672">=</span> <span style="color:#ae81ff">100.0</span>
    <span style="color:#66d9ef">return</span> (a<span style="color:#f92672">-</span>x[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> b<span style="color:#f92672">*</span>(x[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rastrigin</span>(x):
    A <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>
    n <span style="color:#f92672">=</span> len(x)
    ret <span style="color:#f92672">=</span> A<span style="color:#f92672">*</span>n
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
        ret <span style="color:#f92672">+=</span> x[i]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> A <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>cos(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>pi<span style="color:#f92672">*</span>x[i])
    <span style="color:#66d9ef">return</span> ret

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">visualise_functions</span>():
    nx, ny <span style="color:#f92672">=</span> (<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>)
    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">5</span>, nx)
    y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">5</span>, ny)
    xv, yv <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
    eval_convex <span style="color:#f92672">=</span> convex([xv, yv])
    eval_rastrigin <span style="color:#f92672">=</span> rastrigin([xv, yv])
    eval_rosenbrock <span style="color:#f92672">=</span> rosenbrock([xv, yv])

    plt<span style="color:#f92672">.</span>contourf(x, y, eval_convex)
    plt<span style="color:#f92672">.</span>colorbar()
    plt<span style="color:#f92672">.</span>show()
    plt<span style="color:#f92672">.</span>clf()
    plt<span style="color:#f92672">.</span>contourf(x, y, eval_rosenbrock)
    plt<span style="color:#f92672">.</span>colorbar()
    plt<span style="color:#f92672">.</span>show()
    plt<span style="color:#f92672">.</span>clf()
    plt<span style="color:#f92672">.</span>contourf(x, y, eval_rastrigin)
    plt<span style="color:#f92672">.</span>colorbar()
    plt<span style="color:#f92672">.</span>show()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">optimize</span>(function, method, autodiff):
    eval_points_x <span style="color:#f92672">=</span> []
    eval_points_y <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fill_eval_points</span>(xk):
        eval_points_x<span style="color:#f92672">.</span>append(xk[<span style="color:#ae81ff">0</span>])
        eval_points_y<span style="color:#f92672">.</span>append(xk[<span style="color:#ae81ff">1</span>])

    x0 <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">2.5</span>, <span style="color:#ae81ff">2.5</span>])
    <span style="color:#66d9ef">if</span> autodiff:
        jac <span style="color:#f92672">=</span> grad(function)
    <span style="color:#66d9ef">else</span>:
        jac <span style="color:#f92672">=</span> None

    <span style="color:#66d9ef">if</span> method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;shgo&#39;</span>:
        bounds <span style="color:#f92672">=</span> [(<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>), (<span style="color:#f92672">-</span><span style="color:#ae81ff">10.0</span>, <span style="color:#ae81ff">10.0</span>)]
        res <span style="color:#f92672">=</span> shgo(function, bounds, callback<span style="color:#f92672">=</span>fill_eval_points,
                    options<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;disp&#39;</span>: True})
    <span style="color:#66d9ef">else</span>:
        res <span style="color:#f92672">=</span> minimize(function, x0, method<span style="color:#f92672">=</span>method, callback<span style="color:#f92672">=</span>fill_eval_points,
                        jac <span style="color:#f92672">=</span> jac,
                    options<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;disp&#39;</span>: True})

    nx, ny <span style="color:#f92672">=</span> (<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>)
    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">5</span>, nx)
    y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">5</span>, ny)
    xv, yv <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
    eval_function <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>empty_like(xv)
    eval_function <span style="color:#f92672">=</span> function([xv, yv])

    <span style="color:#66d9ef">print</span>(function<span style="color:#f92672">.</span>__name__)
    plt<span style="color:#f92672">.</span>clf()
    plt<span style="color:#f92672">.</span>contourf(x, y, eval_function)
    plt<span style="color:#f92672">.</span>plot(eval_points_x, eval_points_y, <span style="color:#e6db74">&#39;x-k&#39;</span>)
    plt<span style="color:#f92672">.</span>colorbar()
    neval <span style="color:#f92672">=</span> res<span style="color:#f92672">.</span>nfev
    <span style="color:#66d9ef">try</span>:
        neval <span style="color:#f92672">+=</span> res<span style="color:#f92672">.</span>njev
    <span style="color:#66d9ef">except</span>:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;no njev&#39;</span>)
    <span style="color:#66d9ef">try</span>:
        neval <span style="color:#f92672">+=</span> res<span style="color:#f92672">.</span>nhev
    <span style="color:#66d9ef">except</span>:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;no nhev&#39;</span>)
    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;iterations: {} evaluations: {}&#39;</span><span style="color:#f92672">.</span>format(res<span style="color:#f92672">.</span>nit, neval))

    <span style="color:#66d9ef">if</span> autodiff:
        ext <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;-auto.pdf&#39;</span>
    <span style="color:#66d9ef">else</span>:
        ext <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.pdf&#39;</span>

    plt<span style="color:#f92672">.</span>savefig(function<span style="color:#f92672">.</span>__name__ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> method <span style="color:#f92672">+</span> ext)


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    <span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> [convex_function, rosenbrock, rastrigin]:
        <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;shgo&#39;</span>,<span style="color:#e6db74">&#39;nelder-mead&#39;</span>, <span style="color:#e6db74">&#39;cg&#39;</span>, <span style="color:#e6db74">&#39;bfgs&#39;</span>, <span style="color:#e6db74">&#39;newton-cg&#39;</span>]:
            <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> [False, True]:
                <span style="color:#66d9ef">if</span> m <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;newton-cg&#39;</span> <span style="color:#f92672">and</span> a <span style="color:#f92672">==</span> False:
                    <span style="color:#66d9ef">continue</span>
                <span style="color:#66d9ef">if</span> m <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;shgo&#39;</span> <span style="color:#f92672">and</span> a <span style="color:#f92672">==</span> True:
                    <span style="color:#66d9ef">continue</span>
                optimize(f, m, a)</code></pre></div>
</div>

</details>



<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/scientific-computing/js/clipboard.min.js?1611598308"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.min.js?1611598308"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.jquery.min.js?1611598308"></script>
    <script src="/scientific-computing/js/jquery.sticky.js?1611598308"></script>
    <script src="/scientific-computing/js/featherlight.min.js?1611598308"></script>
    <script src="/scientific-computing/js/highlight.pack.js?1611598308"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/scientific-computing/js/modernizr.custom-3.6.0.js?1611598308"></script>
    <script src="/scientific-computing/js/learn.js?1611598308"></script>
    <script src="/scientific-computing/js/hugo-learn.js?1611598308"></script>
    
    

  </body>
</html>

