<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="description" content="An online course on Modelling and Scientific Computing in Python for the SABS:R3 Centre for Doctoral Training https://www.sabsr3.ox.ac.uk/">
<meta name="author" content="Martin Robinson">

    <link rel="shortcut icon" href="/ScientificComputingInMatlab/logos/dtc_hex.svg" type="image/x-icon" />

    <title>Trust Region Methods   Modelling and Scientific Computing</title>

    
    <link href="/scientific-computing/css/nucleus.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/fontawesome-all.min.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/hybrid.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/featherlight.min.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/perfect-scrollbar.min.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/auto-complete.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/atom-one-dark-reasonable.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/theme.css?1641985009" rel="stylesheet">
    <link href="/scientific-computing/css/hugo-theme.css?1641985009" rel="stylesheet">
    
    <link href="/scientific-computing/css/theme-dtc.css?1641985009" rel="stylesheet">
    
    

    <script src="/scientific-computing/js/jquery-3.3.1.min.js?1641985009"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
        });
    });
</script>



  </head>
  <body class="" data-url="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://sabs-r3.github.io/scientific-computing/">
    <img src="/scientific-computing/logos/SABSR3.svg" alt="SABSR3 logo">
</a>
  

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/scientific-computing/js/lunr.min.js?1641985009"></script>
<script type="text/javascript" src="/scientific-computing/js/auto-complete.js?1641985009"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/sabs-r3.github.io\/scientific-computing\/";
    
</script>
<script type="text/javascript" src="/scientific-computing/js/search.js?1641985009"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_0_introduction/" title="Course introduction" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_0_introduction/">
          Course introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/01_course_overview/" title="Course Overview" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/01_course_overview/">
        1. Course Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/02_course_activities/" title="Course Activities" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/02_course_activities/">
        2. Course Activities
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/03_getting_python/" title="Getting Python" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/03_getting_python/">
        3. Getting Python
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_1_linear_algebra/" title="Direct Solvers and Matrix Decompositions" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_1_linear_algebra/">
          <b>Day 1. </b>Direct Solvers and Matrix Decompositions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/" title="Matrix form of equations" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/">
        Matrix form of equations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/" title="Gaussian Elimination" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/">
        Gaussian Elimination
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/" title="Matrix decompositions" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/">
        Matrix decompositions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/" title="LU decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/">
        LU decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/" title="Cholesky decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/">
        Cholesky decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/" title="QR decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/">
        QR decomposition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_2_linear_algebra/">
          <b>Day 2. </b>Sparse Matrices and Iterative Solvers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/" title="Sparse matrices" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
        Sparse matrices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/">
        COOrdinate format
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/03-finite-difference/" title="Finite Difference Matrix" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/03-finite-difference/">
        Finite Difference Matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/" title="Scipy.sparse and problems" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/">
        Scipy.sparse and problems
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/" title="Iterative methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/">
        Iterative methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/" title="Jacobi and Relaxation Methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/">
        Jacobi and Relaxation Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/" title="Krylov subspace methods and CG" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/">
        Krylov subspace methods and CG
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/" title="Iterative solvers in Scipy" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/">
        Iterative solvers in Scipy
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_3_ode/" title="Solving ODEs" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_3_ode/">
          <b>Day 3. </b>Solving ODEs
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/01-am/" title="ODE Solvers - AM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_3_ode/01-am/">
        ODE Solvers - AM exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_3_ode/02-pm/" title="ODE Solvers - PM exercise" class="dd-item ">
        <a href="/scientific-computing/unit_3_ode/02-pm/">
        ODE Solvers - PM exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_4_optimisation/" title="Non-linear Optimisation" class="dd-item
        parent
        
        
        ">
      <a href="/scientific-computing/unit_4_optimisation/">
          <b>Day 4. </b>Non-linear Optimisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/" title="Nonlinear Optimisation" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/">
        Nonlinear Optimisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/02-line-search-methods/">
        Line Search Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/03-trust-region-methods/" title="Trust Region Methods" class="dd-item active">
        <a href="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
        Trust Region Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/">
        Derivative-free methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/05-finite-difference-method/" title="Finite difference method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
        Finite difference method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/06-nelder-mead/">
        Nelder-Mead method
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/" title="Bayesian Inference" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_5_bayesian_inference/">
          <b>Day 5. </b>Bayesian Inference
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_6_projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_6_projects/">
          <b>Day 6-8. </b>Projects
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_6_projects/01-project-description/" title="Project description" class="dd-item ">
        <a href="/scientific-computing/unit_6_projects/01-project-description/">
        Project description
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/SABS-R3/scientific-computing/blob/master/hugo_site/content/unit_4_optimisation/03-trust-region-methods.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/scientific-computing/'></a> > <a href='/scientific-computing/unit_4_optimisation/'>Non-linear Optimisation</a> > Trust Region Methods
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Trust Region Methods
            </h1>
          

        


<h3 id="saddle-points">Saddle points</h3>

<p>Saddle point pose a particular challenge in non-linear optimisation, particularly in
higher dimensions. The plots below show two examples of saddle points in two dimensions.
Like local minima and maxima, these are stationary points where the gradient of the
function is zero $\nabla f = 0$, but where the value of the function rises along certain
directions and reduces along others (left plot). An alternative type of saddle point
arises when the hessian is singular, and are characterised by a plateau around the
stationary point, like the <a href="https://en.wikipedia.org/wiki/Monkey_saddle">monkey saddle</a>
depicted in the plot to the right.</p>

<p><figure><img src="/scientific-computing/images/unit_04/saddle.svg" alt="Two examples of saddle points"></figure></p>

<p>Gradient descent perform poorly, with very slow convergence near saddle points, and
Newtons methods tend to be
<a href="https://www.offconvex.org/2016/03/22/saddlepoints/">attracted</a> and
<a href="https://arxiv.org/abs/1405.4604">trapped</a> in saddle points, due to the presence of
negative eigenvalues in the hessian matrix. This can be avoided by approximating the
hessian with a positive definite matrix $B_k \approx \nabla^2 f$, like some quasi-Newton
methods (i.e. BFGS). Alternatively, the class of <em>trust region methods</em> restate the
optimisation problem as an sequence of optimisations of a second order approximation to
$f$ in a local <em>trust-region</em> surrounding the current point $a_k$. The exact solution to
each of these subproblems can be shown to be $(\nabla^2 f(a_k) + \lambda I)^{-1} \nabla
f(a_k)$, where $\lambda$ is chosen to be large enough to make $(\nabla^2 f(a_k) +
\lambda I)$ positive definite. Therefore, by design the trust-region methods aim avoid
this problem of negative eigenvalues.</p>

<h3 id="trust-region-methods">Trust region methods</h3>

<p>Like many line search methods, trust region methods also use the second order Taylor
expansion of $f$ around $a_k$</p>

<p><span  class="math">\[
f(a_k + p) \approx f(a_k) + g_k^T p + \frac{1}{2} p^T B_k p = m_k(p)
\]</span></p>

<p>where $g_k = \nabla f(a_k)$, $B_k$ is an approximation to the hessian matrix $B_k
\approx \nabla^2 f(a_k)$ or the hessian itself $B_k = \nabla^2 f(a_k)$. Trust region
methods aim to find the $p$ that minimises $m_k$ in a local trust region  $||p|| &lt;
\Delta_k$ around the current point $a_k$, where $\Delta_k$ is the trust region radius.</p>

<p>Solving the minimisation given above is normally done approximately, with different
trust region methods varying how the approximation is achieved. Choosing the
trust-region radius is fundamental to this class of methods, and is done by comparing
the actual to the predicted reduction in the function value</p>

<p><span  class="math">\[
\rho_k = \frac{f(a_k) - f(a_k + p_k)}{m_k(0) - m_k(p_k)}.
\]</span></p>

<p>Since $m_k(0) - m_k(p_k)$ is always positive, if $\rho_k$ is negative then the actual
function value is increasing, the step is rejected and the trust region radius
$\Delta_k$ is decreased in order to improve the approximate model $m_k$. If $\rho_k$ is
positive but much smaller than one then we do not alter $\Delta_k$. If $\rho_k$ is close
to or greater than 1 we can be confident in our model and thus increase $\Delta_k$. The
general algorithm for a trust region method (reproduced from the text by Nocedal and
Wright cited below) is:</p>

<p>Given $a_0$, $\hat{\Delta} &gt; 0$, $\Delta_0 \in (0, \hat{\Delta})$, and $\nu \in [0,
\frac{1}{4})$: <br>
<strong>for</strong> $k = 0, 1, 2, ...$ <br>
&nbsp;&nbsp; Obtain $p_k$ by (approximately) minimising $m_k(p)$ where $||p|| &lt; \Delta_k$
<br>
&nbsp;&nbsp; $\rho_k := \frac{f(a_k) - f(a_k + p_k)}{m_k(0) - m_k(p_k)}$ <br>
&nbsp;&nbsp; <strong>if</strong> $\rho_k &lt; \frac{1}{4}$ <br>
&nbsp;&nbsp;&nbsp;&nbsp; $\Delta_{k+1} := \frac{1}{4} \Delta_k$ <br>
&nbsp;&nbsp; <strong>else</strong> <br>
&nbsp;&nbsp; &nbsp;&nbsp;<strong>if</strong> $\rho_k &gt; \frac{3}{4}$ and $||p_k|| = \Delta_k$ <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; $\Delta_{k+1} := \min(2 \Delta_k, \hat{\Delta})$
<br>
&nbsp;&nbsp; &nbsp;&nbsp;<strong>else</strong> <br>
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; $\Delta_{k+1} := \Delta_k$ <br>
&nbsp;&nbsp; <strong>if</strong> $\rho_k &gt; \nu$ <br>
&nbsp;&nbsp; &nbsp;&nbsp; $a_{k+1} := a_k + p_k$<br>
&nbsp;&nbsp;<strong>else</strong> <br>
&nbsp;&nbsp; &nbsp;&nbsp; $a_{k+1} := a_k$<br>
<strong>end for</strong></p>

<p>We will describe two algorithms for minimising $m_k(p)$, the <em>Cauchy point</em> and the
<em>dogleg</em> methods. The Cauchy point first solves a linear version of $m_k$ defined as</p>

<p><span  class="math">\[
p^s_k = \min_{p \in \mathcal{R}^n} f(a_k) + g_k^T p \text{ for }||p|| \le \Delta_k
\]</span></p>

<p>Subsequently, $p^s_k$ is used to find the scalar $\tau_k &gt; 0$ such that</p>

<p><span  class="math">\[
\tau_k = \min_{\tau \ge 0} m_k(\tau p_k^s) \text{ for }||\tau p_k^s|| \le \Delta_k
\]</span></p>

<p>Finally, the Cauchy point is given as $p_k^C = \tau_k p_k^s$.</p>

<p>The solution to this problem can be shown to be</p>

<p><span  class="math">\[
p_k^C = -\tau_k \frac{\Delta_k}{|| g_k ||} g_k,
\]</span></p>

<p>where</p>

<p><span  class="math">\[
\tau_k = \begin{cases}
1 & \text{if }g_k^T B_k g_k \le 0 \\
\min (||g_k||^3 / (\Delta_k g_k^T B_k g_k), 1) & \text{otherwise}.
\end{cases}
\]</span></p>

<p>The second method we describe is the <em>dogleg</em> method, which is applicable when $B_k$ is
a positive definite matrix. If the original hessian is positive definite then this
method is directly applicable, or one of the quasi-Newton positive definite
approximation to the hessian could also be used. The dogleg method is derived by
considering the path of the $p$ that minimises $m_k(p)$ with increasing $\Delta_k$,
which forms a curved path in parameter space. The method approximates this path with two
straight line segments. The first segment follows the steepest descent direction and is
given by</p>

<p><span  class="math">\[
p_k^U = -\frac{g_k^T g_k}{g_k^T B_k g_k} g_k
\]</span></p>

<p>The second step is along the path between $p_k^U$ and $p^B_k = -B_k^{-1} g_k$. In the
case where $p_k^B$ is <em>inside</em> the trust region $||p_k^B|| \le \Delta_k$ then $p_k^B$
can be used without modification. Otherwise the point of intersection with the
trust-region radius must be calculated, which can be done by solving the following
quadratic equation</p>

<p><span  class="math">\[
||p_k^U + (\tau - 1)(p_k^B - p_k^U)||^2 = \Delta_k^2
\]</span></p>

<p>with the second segment being defined by</p>

<p><span  class="math">\[
\tilde{p}_k(\tau) = \begin{cases}
\tau p_k^U, & 0 \le \tau 1, \\
p_k^U + (\tau - 1)(p_k^B - p_k^U), & 1 \le \tau \le 2.
\end{cases}
\]</span></p>

<h3 id="problems">Problems</h3>


<div class="notices question" >
  <div class="label">Question</div>
  <ol>
<li>Let $f(x) = 10 \left( x_2 − x^2_1 \right)^2 + (1 − x_1)^2$. At $x = (0,−1)$ draw the
contour lines of the quadratic model
<br></li>
</ol>

<p><span  class="math">\[
   m_k(p) = f(a_k) + g_k^T p + \frac{1}{2} p^T B_k p,
   \]</span></p>

<p>assuming that $B_k$ is the Hessian of $f$. Draw the family of solutions of $\min_{p
   \in \mathcal{R}^n}m_k(p)$ so that $||p|| \le \Delta_k$  as the trust region radius
   varies from $\Delta_k = 0$ to $\Delta_k = 2$. Repeat this at $x = (0, 0.5)$.</p>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pylab <span style="color:#f92672">as</span> plt

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(x):
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">10</span><span style="color:#f92672">*</span>(x[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">-</span> x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>x[<span style="color:#ae81ff">0</span>])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">grad_f</span>(x):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array([
        <span style="color:#ae81ff">40</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> x[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>,
        <span style="color:#f92672">-</span><span style="color:#ae81ff">20</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">20</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">1</span>]
    ])

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hessian_f</span>(x):
    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>array([
        [<span style="color:#ae81ff">120</span> <span style="color:#f92672">*</span> x[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">40</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">40</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">0</span>]],
        [<span style="color:#f92672">-</span><span style="color:#ae81ff">40</span><span style="color:#f92672">*</span>x[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">20</span>],
    ])

<span style="color:#75715e"># plot contours</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">100</span>)
y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">1.5</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">100</span>)
X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
Z <span style="color:#f92672">=</span> f([X, Y])
plt<span style="color:#f92672">.</span>contour(X, Y, Z, levels<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
min_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1.</span>, <span style="color:#ae81ff">1.</span>])

<span style="color:#66d9ef">for</span> x0 <span style="color:#f92672">in</span> [np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1.</span>]), np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">0.5</span>])]:
    N <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
    x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>empty((N, <span style="color:#ae81ff">2</span>), dtype<span style="color:#f92672">=</span>float)
    plt<span style="color:#f92672">.</span>plot(x0[<span style="color:#ae81ff">0</span>], x0[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;.&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(min_x[<span style="color:#ae81ff">0</span>], min_x[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;+&#39;</span>)
    <span style="color:#66d9ef">for</span> i, delta <span style="color:#f92672">in</span> enumerate(np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1e-3</span>, <span style="color:#ae81ff">2</span>, N)):
        <span style="color:#75715e"># if minimum of f is within radius, this is the min point, otherwise it is</span>
        <span style="color:#75715e"># somewhere on the border of the search radius</span>
        <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>sum((min_x <span style="color:#f92672">-</span> x0)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">&lt;</span> delta<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>:
            x[i, :] <span style="color:#f92672">=</span> min_x
        <span style="color:#66d9ef">else</span>:
            min_f <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e10</span>
            <span style="color:#66d9ef">for</span> omega <span style="color:#f92672">in</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>np<span style="color:#f92672">.</span>pi, <span style="color:#ae81ff">200</span>):
                test_x <span style="color:#f92672">=</span> x0 <span style="color:#f92672">+</span> delta <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>array([np<span style="color:#f92672">.</span>cos(omega), np<span style="color:#f92672">.</span>sin(omega)])
                test_f <span style="color:#f92672">=</span> f(test_x)
                <span style="color:#66d9ef">if</span> test_f <span style="color:#f92672">&lt;</span> min_f:
                    x[i, :] <span style="color:#f92672">=</span> test_x
                    min_f <span style="color:#f92672">=</span> test_f
    plt<span style="color:#f92672">.</span>plot(x[:, <span style="color:#ae81ff">0</span>], x[:, <span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;-.&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)

plt<span style="color:#f92672">.</span>show()</code></pre></div>
</div>

</details>



<div class="notices question" >
  <div class="label">Question</div>
  <ol start="2">
<li>Write a program that implements the dogleg method. Choose $B_k$ to be the exact
Hessian. Apply it to minimise the function in (1) from the same two starting
points. If you wish, experiment with the update rule for the trust region by
changing the constants in the trust region algorithm given above, or by designing
your own rules.</li>
</ol>

</div>



<details>
    <summary>Expand for solution</summary>
    <div class="notices solution" >
  <div class="label">Solution</div>
  <div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">line_sphere_intersect</span>(o, u, r2):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    algorithm from https://en.wikipedia.org/wiki/Line</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">2</span><span style="color:#e6db74">%80%</span><span style="color:#e6db74">93sphere_intersection
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    here we assume that the line intersects the sphere, and we are only interested in
</span><span style="color:#e6db74">    the most positive solution
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    u_dot_o <span style="color:#f92672">=</span> u<span style="color:#f92672">.</span>dot(o)
    det <span style="color:#f92672">=</span> u_dot_o<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> (np<span style="color:#f92672">.</span>dot(o, o) <span style="color:#f92672">-</span> r2)
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>u_dot_o <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>sqrt(det)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dogleg</span>(delta, g, B, x0):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    implements the dogleg method of minimising m(p)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    returns min p and a boolean that is True if min p lies on the trust region border
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    delta2 <span style="color:#f92672">=</span> delta<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
    pB <span style="color:#f92672">=</span> <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>solve(B, g)

    <span style="color:#75715e"># if pB is within trust region then use that</span>
    <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>dot(pB, pB) <span style="color:#f92672">&lt;</span> delta2:
        <span style="color:#66d9ef">return</span> pB, False

    pU <span style="color:#f92672">=</span> <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>dot(g, g) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>dot(g, B <span style="color:#960050;background-color:#1e0010">@</span> g) <span style="color:#f92672">*</span> g

    <span style="color:#75715e"># find intersection of segment x0 -&gt; pU -&gt; pB with trust region</span>
    <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>dot(pU, pU) <span style="color:#f92672">&gt;</span> delta2:
        u <span style="color:#f92672">=</span> (pU <span style="color:#f92672">-</span> x0) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(pU <span style="color:#f92672">-</span> x0)
        intersect <span style="color:#f92672">=</span> line_sphere_intersect(x0, u, delta2)
        <span style="color:#66d9ef">return</span> x0 <span style="color:#f92672">+</span> intersect <span style="color:#f92672">*</span> u, True
    <span style="color:#66d9ef">else</span>:
        u <span style="color:#f92672">=</span> (pB <span style="color:#f92672">-</span> pU) <span style="color:#f92672">/</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(pB <span style="color:#f92672">-</span> pU)
        intersect <span style="color:#f92672">=</span> line_sphere_intersect(pU, u, delta2)
        <span style="color:#66d9ef">return</span> pU <span style="color:#f92672">+</span> intersect <span style="color:#f92672">*</span> u , True


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">minimise</span>(f, grad_f, hessian_f, x0, tol<span style="color:#f92672">=</span><span style="color:#ae81ff">1e-5</span>, max_iter<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>):
    nu <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>
    delta_hat <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>
    delta <span style="color:#f92672">=</span> delta_hat
    a <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>copy(x0)
    a_store <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>empty((max_iter<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, len(x0)), dtype<span style="color:#f92672">=</span>float)
    a_store[<span style="color:#ae81ff">0</span>, :] <span style="color:#f92672">=</span> a
    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(max_iter):
        g <span style="color:#f92672">=</span> grad_f(a)
        B <span style="color:#f92672">=</span> hessian_f(a)
        f_a <span style="color:#f92672">=</span> f(a)
        p, p_equal_delta <span style="color:#f92672">=</span> dogleg(delta, g, B, a)
        rho <span style="color:#f92672">=</span> (f_a <span style="color:#f92672">-</span> f(a <span style="color:#f92672">+</span> p)) <span style="color:#f92672">/</span> (<span style="color:#f92672">-</span>g<span style="color:#f92672">.</span>dot(p) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>p<span style="color:#f92672">.</span>dot(B <span style="color:#960050;background-color:#1e0010">@</span> p))
        <span style="color:#66d9ef">if</span> rho <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.25</span>:
            delta <span style="color:#f92672">*=</span> <span style="color:#ae81ff">0.25</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">if</span> rho <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.75</span> <span style="color:#f92672">and</span> p_equal_delta:
                delta <span style="color:#f92672">=</span> min(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>delta, delta_hat)
        <span style="color:#66d9ef">if</span> rho <span style="color:#f92672">&gt;</span> nu:
            a <span style="color:#f92672">+=</span> p
            a_store[j, :] <span style="color:#f92672">=</span> a
            j <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">if</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(p) <span style="color:#f92672">&lt;</span> tol:
                <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">return</span> a_store[:j, :]

<span style="color:#75715e"># plot contours</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">100</span>)
y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#f92672">-</span><span style="color:#ae81ff">1.5</span>, <span style="color:#ae81ff">2.0</span>, <span style="color:#ae81ff">100</span>)
X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(x, y)
Z <span style="color:#f92672">=</span> f([X, Y])
plt<span style="color:#f92672">.</span>contour(X, Y, Z, levels<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
min_x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1.</span>, <span style="color:#ae81ff">1.</span>])

<span style="color:#75715e"># do the minimisation for both points and plot all iterations</span>
<span style="color:#66d9ef">for</span> x0 <span style="color:#f92672">in</span> [np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1.</span>]), np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">0.5</span>])]:
    plt<span style="color:#f92672">.</span>plot(x0[<span style="color:#ae81ff">0</span>], x0[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;.&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(min_x[<span style="color:#ae81ff">0</span>], min_x[<span style="color:#ae81ff">1</span>], <span style="color:#e6db74">&#39;+&#39;</span>)
    a_store <span style="color:#f92672">=</span> minimise(f, grad_f, hessian_f, x0)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;done in&#39;</span>, a_store<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#e6db74">&#39;iterations&#39;</span>)
    plt<span style="color:#f92672">.</span>plot(a_store[:, <span style="color:#ae81ff">0</span>], a_store[:, <span style="color:#ae81ff">1</span>])

plt<span style="color:#f92672">.</span>show()</code></pre></div>
</div>

</details>



<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/scientific-computing/js/clipboard.min.js?1641985009"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.min.js?1641985009"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.jquery.min.js?1641985009"></script>
    <script src="/scientific-computing/js/jquery.sticky.js?1641985009"></script>
    <script src="/scientific-computing/js/featherlight.min.js?1641985009"></script>
    <script src="/scientific-computing/js/highlight.pack.js?1641985009"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/scientific-computing/js/modernizr.custom-3.6.0.js?1641985009"></script>
    <script src="/scientific-computing/js/learn.js?1641985009"></script>
    <script src="/scientific-computing/js/hugo-learn.js?1641985009"></script>
    
    

  </body>
</html>

