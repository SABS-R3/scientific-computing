<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="description" content="An online course on Modelling and Scientific Computing in Python for the SABS:R3 Centre for Doctoral Training https://www.sabsr3.ox.ac.uk/">
<meta name="author" content="Martin Robinson">

    <link rel="shortcut icon" href="/ScientificComputingInMatlab/logos/dtc_hex.svg" type="image/x-icon" />

    <title>Sparse matrices   Modelling and Scientific Computing</title>

    
    <link href="/scientific-computing/css/nucleus.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/fontawesome-all.min.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/hybrid.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/featherlight.min.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/perfect-scrollbar.min.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/auto-complete.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/atom-one-dark-reasonable.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/theme.css?1608372327" rel="stylesheet">
    <link href="/scientific-computing/css/hugo-theme.css?1608372327" rel="stylesheet">
    
    <link href="/scientific-computing/css/theme-dtc.css?1608372327" rel="stylesheet">
    
    

    <script src="/scientific-computing/js/jquery-3.3.1.min.js?1608372327"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
        delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
              ]
        });
    });
</script>



  </head>
  <body class="" data-url="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://sabs-r3.github.io/scientific-computing/">
    <img src="/scientific-computing/logos/SABSR3.svg" alt="SABSR3 logo">
</a>
  

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/scientific-computing/js/lunr.min.js?1608372327"></script>
<script type="text/javascript" src="/scientific-computing/js/auto-complete.js?1608372327"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/sabs-r3.github.io\/scientific-computing\/";
    
</script>
<script type="text/javascript" src="/scientific-computing/js/search.js?1608372327"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_0_introduction/" title="Course introduction" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_0_introduction/">
          Course introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/01_course_overview/" title="Course Overview" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/01_course_overview/">
        1. Course Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/02_course_activities/" title="Course Activities" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/02_course_activities/">
        2. Course Activities
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_0_introduction/03_getting_matlab/" title="Getting MATLAB" class="dd-item ">
        <a href="/scientific-computing/unit_0_introduction/03_getting_matlab/">
        3. Getting MATLAB
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_1_linear_algebra/" title="Direct Solvers and Matrix Decompositions" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_1_linear_algebra/">
          <b>Day 1. </b>Direct Solvers and Matrix Decompositions
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/" title="Matrix form of equations" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/01-matrix-form-of-equations/">
        Matrix form of equations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/" title="Gaussian Elimination" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/02-gaussian-elimination/">
        Gaussian Elimination
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/" title="Matrix decompositions" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/03-matrix-decompositions/">
        Matrix decompositions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/" title="LU decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/04-lu-decomposition/">
        LU decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/" title="Cholesky decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/06-cholesky-decomposition/">
        Cholesky decomposition
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/" title="QR decomposition" class="dd-item ">
        <a href="/scientific-computing/unit_1_linear_algebra/07-qr-decomposition/">
        QR decomposition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers" class="dd-item
        parent
        
        
        ">
      <a href="/scientific-computing/unit_2_linear_algebra/">
          <b>Day 2. </b>Sparse Matrices and Iterative Solvers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/" title="Sparse matrices" class="dd-item active">
        <a href="/scientific-computing/unit_2_linear_algebra/01-sparse-matrices/">
        Sparse matrices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/">
        COOrdinate format
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/03-finite-difference/" title="Finite Difference Matrix" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/03-finite-difference/">
        Finite Difference Matrix
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/" title="Scipy.sparse" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/04-scipy-sparse/">
        Scipy.sparse
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/" title="Iterative methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/05-iterative-methods/">
        Iterative methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/" title="Jacobi and Relaxation Methods" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/06-jacobi-relaxation-methods/">
        Jacobi and Relaxation Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/" title="Conjugate Gradient Method" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/07-conjugate-gradient-method/">
        Conjugate Gradient Method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/" title="Scipy.sparse.linalg" class="dd-item ">
        <a href="/scientific-computing/unit_2_linear_algebra/08-scipy.sparse.linalg/">
        Scipy.sparse.linalg
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_3_ode/" title="Solving ODEs" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_3_ode/">
          <b>Day 3. </b>Solving ODEs
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_4_optimisation/" title="Non-linear Optimisation" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_4_optimisation/">
          <b>Day 4. </b>Non-linear Optimisation
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/" title="Nonlinear Optimisation" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/01-nonlinear-optimisation/">
        Nonlinear Optimisation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/02-line-search-methods/" title="Line Search Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/02-line-search-methods/">
        Line Search Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/03-trust-region-methods/" title="Trust Region Methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/03-trust-region-methods/">
        Trust Region Methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/" title="Derivative-free methods" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/04-derivatite-free-methods/">
        Derivative-free methods
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/05-finite-difference-method/" title="Finite difference method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/05-finite-difference-method/">
        Finite difference method
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/scientific-computing/unit_4_optimisation/06-nelder-mead/" title="Nelder-Mead method" class="dd-item ">
        <a href="/scientific-computing/unit_4_optimisation/06-nelder-mead/">
        Nelder-Mead method
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_5_bayesian_inference/" title="Bayesian Inference" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_5_bayesian_inference/">
          <b>Day 5. </b>Bayesian Inference
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/scientific-computing/unit_6_projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/scientific-computing/unit_6_projects/">
          <b>Day 6-8. </b>Projects
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/SABS-R3/scientific-computing/blob/main/hugo_site/content/unit_2_linear_algebra/01-sparse-matrices.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/scientific-computing/'></a> > <a href='/scientific-computing/unit_2_linear_algebra/'>Sparse Matrices and Iterative Solvers</a> > Sparse matrices
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Sparse matrices
            </h1>
          

        


<h2 id="why-sparse-matrices">Why sparse matrices</h2>

<p>Taking advantage of any special structure in the matrix of interest is always of great
importance when designing a linear algebra algorithm/solver. Thus far we have discussed
special structures such as symmetric or positive definite matrices, but one of the most
common matrix structures in scientific computing is that of a <em>sparse matrix</em>, or a
matrix containing many zero elements. Since zeros can be ignored in many computations,
for example multiplication or addition, a sparse matrix will specify a special data
structure so that only the <em>non-zero</em> elements of the matrix are actually stored and
used in computation. Note also that a sparse matrix can itself be symmetric or positive
definite, and it is often neccessary to take all these properties into account when
designing your algorithm.</p>

<p>The most obvious benifit of a sparse matrix is low memory usage. A dense matrix needs to
store all the elements of a matrix of size $n$, and thus the memory requirements scale
as $\mathcal{O}(n^2)$. For example, the following show the memory requirements of a
matrix of double precision numbers (taken from the excellent
<a href="http://scipy-lectures.org/advanced/scipy_sparse/introduction.html#why-sparse-matrices">scipy-lectures</a>)</p>

<p><figure><img src="/scientific-computing/images/unit_02/sparse_versus_dense.svg" alt="least squares problem"></figure></p>

<p>A sparse matrix only stores non-zero elements, and in many different applications this
represents a huge memory saving as matrices are often very sparse, holding only a few
non-zero elements. Some typical applications are:</p>

<ul>
<li>solution of partial differential equations (PDEs), such as the finite difference
method illustrated below</li>
<li>applications of graphs or networks (e.g. electrical networks, website links), where
non-zero elements of the matrix represent edges between nodes</li>
</ul>

<p>Note that while a sparse matrix has obvious benifits in terms of matrix multiplication,
where the zero elements can simply be ignored, direct solver algorithms such as $LU$
decodecomposition for the problem $Ax = b$, where $A$ is sparse, need considerably more
thought as the zeros in $A$ can have propogating effects, and there is no guarentee that
the decomposition of a $A$ or its inverse will be itself sparse, there can be a
significant amount of what is known as <em>fill-in</em>. This fact motivates a separate class
of <em>iterative</em> (as opposed to <em>direct</em>) solvers that only rely on the matrix
multiplication of $A$ with a vector, ignoring the internal sparsity structure of $A$ and
only taking advantage of the increased speed of the matrix multiplication itself. These
iterative solvers will be covered in the following chapter, but in this chapter we will
focus on the practical requirements of constructing and using sparse matrices using the
<code>scipy.sparse</code> library.</p>

<h2 id="an-example-sparse-format">An example sparse format</h2>

<p>The COOrdinate format (COO) is also known as the &quot;ijv&quot; or &quot;triplet&quot; format, and stores
the non-zero elements in three arrays, <code>row</code>, <code>col</code>, and <code>data</code>. The <code>data[i]</code> value is
the non-zero entry in row <code>row[i]</code> and column <code>col[i]</code> of the matrix. The advantages of
this format are:</p>

<ul>
<li>fast format for contructing sparse matrices</li>
<li>fast conversions to/from the CSR and CSC formats</li>
<li>fast matrix-vector multiplication</li>
<li>fast elementwise operations (e.g. multiply each element by 2 is just <code>data * 2</code>)</li>
</ul>

<p>However, slicing using this format is difficult.</p>

<p>Here are some examples of the COO matrix format using
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.coo_matrix.html"><code>scipy.sparse.coo_matrix</code></a>.
Again, these have been taken from
<a href="http://scipy-lectures.org/advanced/scipy_sparse/introduction.html#why-sparse-matrices">scipy-lectures</a>,
which is an excellent resource and contains examples of the other sparse matrix formats
implemented in Scipy.</p>

<h3 id="create-empty-coo-matrix">create empty COO matrix:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mtx <span style="color:#f92672">=</span> sparse<span style="color:#f92672">.</span>coo_matrix((<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>), dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>int8)
mtx<span style="color:#f92672">.</span>todense()</code></pre></div>
<p>Output:</p>
<pre><code>matrix([[0, 0, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 0]], dtype=int8)</code></pre>
<h3 id="create-using-data-ij-tuple">create using (data, ij) tuple:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">row <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>])
col <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>])
data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">9</span>])
mtx <span style="color:#f92672">=</span> sparse<span style="color:#f92672">.</span>coo_matrix((data, (row, col)), shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>))
mtx
mtx<span style="color:#f92672">.</span>todense()</code></pre></div>
<p>Output:</p>
<pre><code>&gt;&gt;&gt; mtx
&lt;4x4 sparse matrix of type &#39;&lt;class &#39;numpy.int64&#39;&gt;&#39;
        with 4 stored elements in COOrdinate format&gt;
&gt;&gt;&gt; mtx.todense()
matrix([[4, 0, 9, 0],
        [0, 7, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 5]])</code></pre>
<h3 id="duplicates-entries-are-summed-together">duplicates entries are summed together:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">row <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>])
col <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>])
data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>])
mtx <span style="color:#f92672">=</span> sparse<span style="color:#f92672">.</span>coo_matrix((data, (row, col)), shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>))
mtx<span style="color:#f92672">.</span>todense()</code></pre></div>
<p>Output:</p>
<pre><code>&gt;&gt;&gt; mtx.todense()
matrix([[3, 0, 1, 0],
        [0, 2, 0, 0],
        [0, 0, 0, 0],
        [0, 0, 0, 1]])</code></pre>
<h3 id="no-slicing">no slicingâ€¦:</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mtx[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]</code></pre></div>
<p>Output:</p>
<pre><code>&gt;&gt;&gt; mtx[2, 3]
Traceback (most recent call last):
  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;
TypeError: &#39;coo_matrix&#39; object is not subscriptable</code></pre>
<h2 id="an-example-sparse-matrix-arising-from-a-finite-difference-discretistaion">An example sparse matrix arising from a finite difference discretistaion</h2>

<p>Many matrices in scientific computing contain mostly zeros, particularly those arising
from the discretistaion of partial differential equations (PDEs). Here we will construct
a sparse matrix using <code>scipy.sparse</code> that is derived from the finite difference
discretistaion of the Poisson equation. In 1D, Poisson equation is</p>

<p><span  class="math">\[u_{xx} = f(x)\text{ for }0 \le x \le 1\]</span></p>

<p>The central FD approximation of $u_{xx}$ is:</p>

<p><span  class="math">\[u_{xx} \approx \frac{u(x + h) - 2u(x) + u(x-h)}{h^2}\]</span></p>

<p>We will discretise $u_{xx} = 0$ at $N$ regular points along $x$ from 0 to 1, given by
$x_1$, $x_2$:</p>
<pre><code>          +----+----+----------+----+&gt; x
          0   x_1  x_2    ... x_N   1</code></pre>
<p>Using this set of point and the discretised eqution, this gives a set of $N$ equations
at each interior point on the domain:</p>

<p><span  class="math">\[\frac{v_{i+1} - 2v_i + v_{i-1}}{h^2} = 0 \text{ for } i = 1...N\]</span></p>

<p>where $v_i \approx u(x_i)$.</p>

<p>To solve these equations we will need additional equations at $x=0$ and $x=1$, known as
the <em>boundary conditions</em>. For this example we will use $u(x) = g(x)$ at $x=0$ and $x=1$
(also known as a non-homogenous Dirichlet bc), so that $v_0 = g(0)$, and $v_{N+1} =
g(1)$, and the equation at $x_1$ becomes:</p>

<p><span  class="math">\[\frac{v_{i+1} - 2v_i + g(0)}{h^2} = 0\]</span></p>

<p>and the equation at $x_N$ becomes:</p>

<p><span  class="math">\[\frac{g(1) - 2v_i + v_{i-1}}{h^2} = 0\]</span></p>

<p>We can therefore represent the final $N$ equations in matrix form like so:</p>

<p><span  class="math">\[
\frac{1}{h^2}
\begin{bmatrix} -2      & 1      &         &   &     \\
 1      & -2     & 1       &       & \\
&\ddots & \ddots  &  \ddots &\\
&        & 1      &  -2     &  1     \\
&        &        &   1     & -2     \end{bmatrix}
\begin{bmatrix} v_1    \\
v_2    \\
\vdots \\
v_{N-1}\\
v_{N}  
\end{bmatrix}
= \begin{bmatrix} -g(0)    \\
0    \\
\vdots \\
0    \\
-g(1)
\end{bmatrix}
\]</span></p>

<p>The relevent sparse matrix here is $A$, given by</p>

<p><span  class="math">\[
A = \begin{bmatrix} -2      & 1      &         &   &     \\
 1      & -2     & 1       &       & \\
&\ddots & \ddots  &  \ddots &\\
&        & 1      &  -2     &  1     \\
&        &        &   1     & -2     \end{bmatrix}
\]</span></p>

<p>As you can see, the number of non-zero elements grows linearly with the size $N$, so a
sparse matrix format is much prefered over a dense matrix holding all $N^2$ elements!</p>

<h2 id="additional-reading">Additional Reading</h2>

<p>For more on the Finite Difference Method for solving PDEs:</p>

<p>K. W. Morton and D. F. Mayers. Numerical Solution of Partial Differential Equations: An
Introduction. Cambridge University Press, 2005.</p>

<h2 id="software">Software</h2>

<p>There are seven available sparse matrix types in <code>scipy.sparse</code>:</p>

<ul>
<li><code>csc_matrix</code>: Compressed Sparse Column format</li>
<li><code>csr_matrix</code>: Compressed Sparse Row format</li>
<li><code>bsr_matrix</code>: Block Sparse Row format</li>
<li><code>lil_matrix</code>: List of Lists format</li>
<li><code>dok_matrix</code>: Dictionary of Keys format</li>
<li><code>coo_matrix</code>: COOrdinate format (aka IJV, triplet format)</li>
<li><code>dia_matrix</code>: DIAgonal format</li>
</ul>

<p>As indicated by the excellent
<a href="https://docs.scipy.org/doc/scipy/reference/sparse.html">documentation</a>, the
<code>dok_matrix</code> or <code>lil_matrix</code> formats are preferable to construct matrices as they
support basic slicing and indexing similar to a standard NumPy array.</p>

<p>You will notice that the FD matrix we have constructed for the Poisson problem is
composed entirely of diagonal elements, as is often the case. If you were constructing a
similar matrix in MATLAB, you would use the
<a href="https://uk.mathworks.com/help/matlab/ref/spdiags.html"><code>spdiags</code></a> function, and
<code>scipy.sparse</code> has its own
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.spdiags.html">equivalent</a>.
However, all the <code>scipy.sparse</code> formats also have special methods
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.lil_matrix.setdiag.html"><code>setdiag</code></a>
which provide a more object-orientated method of doing the same thing.</p>

<p>Scipy has a few different direct solvers for sparse matrics, given below:</p>

<p><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.spsolve.html#scipy.sparse.linalg.spsolve"><code>spsolve</code></a>:
This solves $Ax=b$ where $A$ is converted into CSC or CSR form</p>

<p><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.spsolve_triangular.html#scipy.sparse.linalg.spsolve_triangular"><code>spsolve_triangular</code></a>:
Solves $Ax=b$, where $A$ is assumed to be triangular.</p>

<p><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.factorized.html#scipy.sparse.linalg.factorized"><code>factorized</code></a>:
This computes the $LU$ decomposition of the input matrix $A$, returning a Python
function that can be called to solve $Ax = b$</p>

<p><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.splu.html#scipy.sparse.linalg.splu"><code>splu</code></a>:
This computes the $LU$ decomposition of the input matrix $A$ using the popular SuperLU
library. It returns a Python object of class
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.linalg.SuperLU.html#scipy.sparse.linalg.SuperLU"><code>SuperLU</code></a>,
that has a <code>solve</code> method you can use to solve $Ax = b$</p>

<p>Note, <code>scipy.sparse.linalg</code> also has many iterative solvers, which we will investigate
further in the next chapter.</p>

<h3 id="problem-construction-in-scipysparse">Problem: construction in <code>scipy.sparse</code></h3>

<p>Your goal for this problem is to construct the FD matrix $A$ given above, using
<code>scipy.sparse</code>, and:</p>

<ol>
<li>Visualise the matrix $A$ using the Matplotlib
<a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.pyplot.spy.html"><code>spy</code></a> plot</li>
<li>Solve the Poisson problem using $f(x) = 2 \cos(x) / e^x$ and $g(x) = \sin(x) / e^x$.
Check your answer using the analytical solution $u_{a}(x) = \sin(x) / e^x$.</li>
<li>Vary the number of discretisation points $N$ and calculate $AA$ using both sparse and
dense matrices. For each $N$ calculate the time to calculate the matix
multiplicatiion using Python's
<a href="https://docs.python.org/3/library/time.html#time.perf_counter"><code>time.perf_counter</code></a>,
and plot time verus $N$ for dense and sparse matrix multiplicatiion. Comment on how
the time varies with $N$.</li>
<li>Vary the number of discretisation points $N$ and solve the Poisson problem with
varying $N$, and with using both the sparse and direct $LU$ solvers. For each $N$
record the time taken for both the dense and sparse solvers, and record the numerical
error $||\mathbf{v} - \mathbf{v}_a||_2$. Generate plots of both error and time versus
$N$, and comment on how they vary with $N$</li>
</ol>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/scientific-computing/unit_2_linear_algebra/" title="Sparse Matrices and Iterative Solvers"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/scientific-computing/unit_2_linear_algebra/02-coo-matrix/" title="COOrdinate format" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/scientific-computing/js/clipboard.min.js?1608372327"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.min.js?1608372327"></script>
    <script src="/scientific-computing/js/perfect-scrollbar.jquery.min.js?1608372327"></script>
    <script src="/scientific-computing/js/jquery.sticky.js?1608372327"></script>
    <script src="/scientific-computing/js/featherlight.min.js?1608372327"></script>
    <script src="/scientific-computing/js/highlight.pack.js?1608372327"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/scientific-computing/js/modernizr.custom-3.6.0.js?1608372327"></script>
    <script src="/scientific-computing/js/learn.js?1608372327"></script>
    <script src="/scientific-computing/js/hugo-learn.js?1608372327"></script>
    
    

  </body>
</html>

